# DQNè®­ç»ƒæŸå¤±ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

è®­ç»ƒåˆæœŸæŸå¤±å€¼è¾¾åˆ° **832,795**ï¼Œè¿œè¶…æ­£å¸¸èŒƒå›´ï¼ˆåº”è¯¥åœ¨å‡ åˆ°å‡ åï¼‰ã€‚

## é—®é¢˜æ ¹æº

### 1. âŒ å¥–åŠ±å°ºåº¦è¿‡å¤§
```python
# æ—§ç‰ˆæœ¬ï¼ˆæœ‰é—®é¢˜ï¼‰
prev_std = np.std(prev_energies)  # ~å‡ åƒç„¦è€³
balance_reward = (prev_std - current_std) * 10.0  # å¯èƒ½è¾¾åˆ°å‡ ä¸‡ï¼
```

**é—®é¢˜**ï¼š
- èŠ‚ç‚¹èƒ½é‡ ~40,000J
- èƒ½é‡æ ‡å‡†å·®å¯èƒ½å‡ åƒ
- å¥–åŠ±å€¼å¯èƒ½è¾¾åˆ° Â±10,000 ç”šè‡³æ›´é«˜

### 2. âŒ Qå€¼çˆ†ç‚¸
å·¨å¤§çš„å¥–åŠ± â†’ å·¨å¤§çš„Qå€¼ â†’ å·¨å¤§çš„TDè¯¯å·® â†’ **æŸå¤±çˆ†ç‚¸**

### 3. âŒ å­¦ä¹ ç‡è¿‡é«˜
1e-3çš„å­¦ä¹ ç‡é…åˆå·¨å¤§çš„æ¢¯åº¦ï¼Œå¯¼è‡´æƒé‡æ›´æ–°è¿‡å¤§

## ä¿®å¤æ–¹æ¡ˆ

### âœ… 1. å¥–åŠ±å½’ä¸€åŒ–ï¼ˆæœ€å…³é”®ï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `src/scheduling/dqn_scheduler.py`

```python
# æ–°ç‰ˆæœ¬ï¼ˆå·²ä¿®å¤ï¼‰
max_energy = 50000.0  # å½’ä¸€åŒ–åŸºå‡†

# å½’ä¸€åŒ–æ–¹å·®
prev_std_norm = np.std(prev_energies) / max_energy
current_std_norm = np.std(current_energies) / max_energy
balance_reward = (prev_std_norm - current_std_norm) * 10.0  # -10åˆ°+10

# å½’ä¸€åŒ–æ¯”ä¾‹è€Œéç»å¯¹æ•°é‡
low_energy_ratio = np.sum(current_energies < mean_energy * 0.3) / len(current_energies)
low_energy_penalty = -low_energy_ratio * 5.0  # -5åˆ°0

# æœ€ç»ˆå¥–åŠ±è£å‰ª
total_reward = np.clip(total_reward, -50.0, 50.0)
```

**æ•ˆæœ**ï¼šå¥–åŠ±èŒƒå›´ä» Â±å‡ ä¸‡ ç¼©å°åˆ° **-50åˆ°+50**

### âœ… 2. æ”¹è¿›ç½‘ç»œåˆå§‹åŒ–

**ä¿®æ”¹æ–‡ä»¶**: `src/scheduling/dqn_scheduler.py`

```python
# ä½¿ç”¨Heåˆå§‹åŒ–ï¼ˆé€‚åˆReLUï¼‰
nn.init.kaiming_normal_(self.fc1.weight, mode='fan_in', nonlinearity='relu')
nn.init.kaiming_normal_(self.fc2.weight, mode='fan_in', nonlinearity='relu')
nn.init.kaiming_normal_(self.fc3.weight, mode='fan_in', nonlinearity='relu')

# è¾“å‡ºå±‚å°æƒé‡
nn.init.uniform_(self.fc4.weight, -3e-3, 3e-3)
nn.init.constant_(self.fc4.bias, 0)
```

### âœ… 3. é™ä½å­¦ä¹ ç‡

**ä¿®æ”¹æ–‡ä»¶**: `src/config/simulation_config.py`

```python
# ä» 1e-3 é™ä½åˆ° 3e-4
dqn_lr: float = 3e-4
```

## é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼Œè®­ç»ƒæŸå¤±åº”è¯¥ï¼š

| é˜¶æ®µ | æŸå¤±èŒƒå›´ | è¯´æ˜ |
|------|---------|------|
| åˆæœŸï¼ˆå‰5å›åˆï¼‰ | 10-100 | æ¢ç´¢é˜¶æ®µï¼ŒæŸå¤±è¾ƒé«˜ |
| ä¸­æœŸï¼ˆ5-20å›åˆï¼‰ | 5-50 | å¼€å§‹å­¦ä¹ ï¼ŒæŸå¤±ä¸‹é™ |
| åæœŸï¼ˆ20+å›åˆï¼‰ | 1-20 | æ”¶æ•›é˜¶æ®µï¼ŒæŸå¤±ç¨³å®š |

## éªŒè¯æ–¹æ³•

### 1. æŸ¥çœ‹è®­ç»ƒæ—¥å¿—
```
è®­ç»ƒç»Ÿè®¡:
  - å¹³å‡æŸå¤±: 15.2341  â† åº”è¯¥åœ¨è¿™ä¸ªèŒƒå›´
  - æ¢ç´¢ç‡Îµ: 0.8523
  - ç¼“å†²åŒº: 1024
```

### 2. ç›‘æ§æŸå¤±æ›²çº¿
- æŸå¤±åº”è¯¥é€æ¸ä¸‹é™
- æ³¢åŠ¨å¹…åº¦åº”è¯¥å‡å°
- ä¸åº”è¯¥å‡ºç°çªç„¶çš„å¤§å¹…è·³è·ƒ

### 3. æ£€æŸ¥å¥–åŠ±åˆ†å¸ƒ
æ­£å¸¸çš„å¥–åŠ±åº”è¯¥åœ¨ -50 åˆ° +50 ä¹‹é—´ï¼Œå¤§éƒ¨åˆ†åœ¨ -20 åˆ° +20 ä¹‹é—´ã€‚

## å¦‚æœæŸå¤±ä»ç„¶è¿‡å¤§

### è¿›ä¸€æ­¥è°ƒæ•´ï¼š

1. **é™ä½å­¦ä¹ ç‡**: æ”¹ä¸º `1e-4`
2. **å¢åŠ æ‰¹æ¬¡å¤§å°**: ä» 64 æ”¹ä¸º 128
3. **è°ƒæ•´å¥–åŠ±å°ºåº¦**: è¿›ä¸€æ­¥ç¼©å°å¥–åŠ±èŒƒå›´
4. **æ£€æŸ¥çŠ¶æ€**: ç¡®ä¿æ‰€æœ‰çŠ¶æ€éƒ½åœ¨ [0,1] èŒƒå›´

### è¯Šæ–­å‘½ä»¤ï¼š

```python
# åœ¨è®­ç»ƒå¾ªç¯ä¸­æ·»åŠ è°ƒè¯•è¾“å‡º
print(f"å¥–åŠ±: {reward:.2f}, æŸå¤±: {loss:.2f}")
print(f"Qå€¼èŒƒå›´: [{q_values.min():.2f}, {q_values.max():.2f}]")
```

## ç†è®ºè¯´æ˜

### DQNæŸå¤±å‡½æ•°

```
Loss = MSE(Q(s,a), r + Î³ * max Q(s',a'))
```

å¦‚æœå¥–åŠ± `r` è¿‡å¤§ï¼ˆå‡ ä¸‡ï¼‰ï¼Œç›®æ ‡Qå€¼ä¹Ÿä¼šçˆ†ç‚¸ï¼Œå¯¼è‡´ï¼š
1. TDè¯¯å·®å·¨å¤§
2. æ¢¯åº¦çˆ†ç‚¸
3. æƒé‡æ›´æ–°è¿‡å¤§
4. è®­ç»ƒä¸ç¨³å®š

### å½’ä¸€åŒ–çš„é‡è¦æ€§

**çŠ¶æ€å½’ä¸€åŒ– + å¥–åŠ±å½’ä¸€åŒ– = ç¨³å®šè®­ç»ƒ**

- çŠ¶æ€: [0, 1] èŒƒå›´
- å¥–åŠ±: [-50, 50] èŒƒå›´  
- Qå€¼: çº¦ [-100, 100] èŒƒå›´
- æŸå¤±: çº¦ [0, 100] èŒƒå›´

## æ€»ç»“

âœ… **æ ¸å¿ƒä¿®å¤**: å¥–åŠ±å‡½æ•°å½’ä¸€åŒ–  
âœ… **è¾…åŠ©ä¼˜åŒ–**: ç½‘ç»œåˆå§‹åŒ– + é™ä½å­¦ä¹ ç‡  
âœ… **é¢„æœŸç»“æœ**: æŸå¤±ä» ~830,000 é™ä½åˆ° ~1-50

ğŸ¯ **é‡æ–°è®­ç»ƒå³å¯çœ‹åˆ°æ•ˆæœï¼**

