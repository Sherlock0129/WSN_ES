# æŒ‡ä»¤ä¸‹å‘èƒ½é‡è®¡ç®—åŠŸèƒ½å®ç°æŠ¥å‘Š

## âœ… å®ç°ç›®æ ‡

**æ ¸å¿ƒéœ€æ±‚**: å®ç°ç‰©ç†ä¸­å¿ƒèŠ‚ç‚¹å‘å‚ä¸ä¼ èƒ½çš„èŠ‚ç‚¹ä¸‹å‘æŒ‡ä»¤çš„èƒ½é‡è®¡ç®—ï¼Œç¡®ä¿åˆ†å¸ƒå¼æ§åˆ¶æ¨¡å‹çš„å®Œæ•´æ€§ã€‚

**å®ç°æ–¹æ¡ˆ**: æ–¹æ¡ˆ1ï¼ˆèƒ½é‡è®¡è´¦ï¼‰ - ç®€å•æœ‰æ•ˆï¼Œåªè®¡ç®—èƒ½é‡å¼€é”€è€Œä¸æ¨¡æ‹Ÿå®Œæ•´é€šä¿¡è¿‡ç¨‹

---

## ğŸ“‹ å®ç°å†…å®¹

### **1. é…ç½®é¡¹** (`src/config/simulation_config.py`)

åœ¨`SimulationConfig`ä¸­æ–°å¢ï¼š

```python
# æŒ‡ä»¤ä¸‹å‘èƒ½é‡è®¡ç®—
enable_command_downlink: bool = True  # æ˜¯å¦å¯ç”¨æŒ‡ä»¤ä¸‹å‘èƒ½é‡è®¡ç®—ï¼ˆç‰©ç†ä¸­å¿ƒâ†’èŠ‚ç‚¹ï¼‰
command_packet_size: int = 1          # æŒ‡ä»¤åŒ…å¤§å°ï¼ˆBï¼Œä¸base_data_sizeç›¸åŒï¼‰
```

**è¯´æ˜**ï¼š
- é»˜è®¤å¯ç”¨æŒ‡ä»¤ä¸‹å‘èƒ½é‡è®¡ç®—
- æŒ‡ä»¤åŒ…å¤§å°ç»Ÿä¸€ä¸º1Bï¼Œä¸èŠ‚ç‚¹é—´é€šä¿¡æ•°æ®åŒ…ç›¸åŒ
- å¯é€šè¿‡é…ç½®çµæ´»å¼€å…³

---

### **2. èƒ½é‡è®¡ç®—æ–¹æ³•** (`src/core/energy_simulation.py`)

#### **æ–°å¢å‚æ•°**

```python
def __init__(self, network, time_steps, scheduler=None,
             # ... å…¶ä»–å‚æ•° ...
             # æŒ‡ä»¤ä¸‹å‘å‚æ•°
             enable_command_downlink=True,  # æ˜¯å¦å¯ç”¨æŒ‡ä»¤ä¸‹å‘èƒ½é‡è®¡ç®—
             command_packet_size=1):  # æŒ‡ä»¤åŒ…å¤§å°ï¼ˆBï¼‰
```

#### **æ ¸å¿ƒæ–¹æ³•**: `calculate_command_downlink_energy(physical_center, plans)`

```python
def calculate_command_downlink_energy(self, physical_center, plans):
    """
    è®¡ç®—æŒ‡ä»¤ä¸‹å‘çš„èƒ½é‡æ¶ˆè€—
    
    ç‰©ç†ä¸­å¿ƒéœ€è¦å‘æ‰€æœ‰å‚ä¸ä¼ èƒ½çš„èŠ‚ç‚¹ä¸‹å‘æŒ‡ä»¤ï¼Œå‘ŠçŸ¥å®ƒä»¬æ‰§è¡Œä¼ èƒ½è®¡åˆ’ã€‚
    æ¯ä¸ªèŠ‚ç‚¹ï¼ˆdonorã€receiverã€relayï¼‰éƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªå›ºå®šå¤§å°çš„æŒ‡ä»¤åŒ…ã€‚
    
    èƒ½é‡è®¡ç®—ï¼š
    - ä¸­å¿ƒå‘é€ï¼šE_tx = center.energy_consumption(node, command_size, transfer_WET=False)
    - èŠ‚ç‚¹æ¥æ”¶ï¼šE_rx = node.energy_consumption(center, command_size, transfer_WET=False)
    - åŒå‘æ‰£é™¤ï¼šcenter.current_energy -= E_tx, node.current_energy -= E_rx
    
    :param physical_center: ç‰©ç†ä¸­å¿ƒèŠ‚ç‚¹
    :param plans: ä¼ èƒ½è®¡åˆ’åˆ—è¡¨
    :return: (total_energy, success) - æ€»èƒ½é‡æ¶ˆè€—å’Œæ˜¯å¦æˆåŠŸ
    """
```

**åŠŸèƒ½ç‰¹æ€§**ï¼š

1. **èŠ‚ç‚¹å»é‡**: è‡ªåŠ¨å»é‡ï¼ŒåŒä¸€èŠ‚ç‚¹åœ¨å¤šä¸ªplanä¸­åªè®¡ç®—ä¸€æ¬¡
2. **åŒå‘æ‰£é™¤**: 
   - ä¸­å¿ƒå‘é€èƒ½é‡ï¼ˆE_txï¼‰
   - èŠ‚ç‚¹æ¥æ”¶èƒ½é‡ï¼ˆE_rxï¼‰
   - åŒæ—¶æ‰£é™¤ä¸¤è€…çš„èƒ½é‡
3. **èƒ½é‡æ£€æŸ¥**: ä¸­å¿ƒèƒ½é‡ä¸è¶³æ—¶è¿”å›å¤±è´¥ï¼Œå–æ¶ˆæœ¬è½®ä¼ èƒ½
4. **å›ºå®šåŒ…å¤§å°**: æ‰€æœ‰æŒ‡ä»¤åŒ…ç»Ÿä¸€ä¸º1Bï¼ˆ`command_packet_size`ï¼‰

---

### **3. æ‰§è¡Œæµç¨‹é›†æˆ**

åœ¨`simulate()`æ–¹æ³•çš„ä¼ èƒ½è®¡åˆ’æ‰§è¡Œä¹‹å‰æ’å…¥æŒ‡ä»¤ä¸‹å‘ï¼š

```python
# ç”Ÿæˆä¼ èƒ½è®¡åˆ’
result = self.scheduler.plan(self.network, t)
if isinstance(result, tuple):
    plans, cand = result
else:
    plans = result

# è®¡ç®—å¹¶æ‰£é™¤æŒ‡ä»¤ä¸‹å‘èƒ½é‡
physical_center = self.network.get_physical_center()
command_energy, can_execute = self.calculate_command_downlink_energy(physical_center, plans)

# åªæœ‰æŒ‡ä»¤ä¸‹å‘æˆåŠŸæ‰æ‰§è¡Œä¼ èƒ½è®¡åˆ’
if can_execute:
    # æ‰§è¡Œä¼ èƒ½
    self.network.execute_energy_transfer(plans, current_time=t)
else:
    # æŒ‡ä»¤ä¸‹å‘å¤±è´¥ï¼Œå–æ¶ˆä¼ èƒ½è®¡åˆ’
    plans = []
    print("[æŒ‡ä»¤ä¸‹å‘] è­¦å‘Šï¼šç‰©ç†ä¸­å¿ƒèƒ½é‡ä¸è¶³ï¼Œæœ¬è½®ä¼ èƒ½å–æ¶ˆ")
```

---

### **4. å‚æ•°ä¼ é€’** (`src/config/simulation_config.py`)

åœ¨`ConfigManager.create_energy_simulation()`ä¸­ä¼ é€’å‚æ•°ï¼š

```python
def create_energy_simulation(self, network, scheduler=None):
    return EnergySimulation(
        # ... å…¶ä»–å‚æ•° ...
        # æŒ‡ä»¤ä¸‹å‘å‚æ•°
        enable_command_downlink=self.simulation_config.enable_command_downlink,
        command_packet_size=self.simulation_config.command_packet_size
    )
```

---

## ğŸ” ç®—æ³•ç»†èŠ‚

### **èŠ‚ç‚¹æ”¶é›†**

```python
# æ”¶é›†æ‰€æœ‰éœ€è¦é€šçŸ¥çš„èŠ‚ç‚¹ï¼ˆå»é‡ï¼‰
notified_nodes = set()
for plan in plans:
    # donorå’Œreceiver
    notified_nodes.add(plan['donor'])
    notified_nodes.add(plan['receiver'])
    # ä¸­ç»§èŠ‚ç‚¹ï¼ˆpathä¸­é™¤äº†èµ·ç‚¹å’Œç»ˆç‚¹çš„èŠ‚ç‚¹ï¼‰
    if 'path' in plan and len(plan['path']) > 2:
        for node in plan['path'][1:-1]:
            notified_nodes.add(node)
```

**ç¤ºä¾‹**ï¼š
```
Plan 1: Node1 â†’ Node2
Plan 2: Node3 â†’ Node2 (Node2é‡å¤)
Plan 3: Node4 â†’ Node1 â†’ Node5 (Node1ä½œä¸ºä¸­ç»§)

å»é‡åé€šçŸ¥èŠ‚ç‚¹: {Node1, Node2, Node3, Node4, Node5} (5ä¸ª)
```

### **èƒ½é‡è®¡ç®—**

```python
for node in notified_nodes:
    # ä¸´æ—¶è®¾ç½®æ•°æ®åŒ…å¤§å°ä¸ºcommand_size_bytes
    physical_center.B = command_size_bytes
    node.B = command_size_bytes
    
    # è®¡ç®—ä¸­å¿ƒå‘é€èƒ½é‡
    E_tx = physical_center.energy_consumption(
        target_node=node,
        transfer_WET=False
    )
    
    # è®¡ç®—èŠ‚ç‚¹æ¥æ”¶èƒ½é‡
    E_rx = node.energy_consumption(
        target_node=physical_center,
        transfer_WET=False
    )
    
    # ç´¯åŠ èƒ½é‡
    center_energy_cost += E_tx
    total_energy += (E_tx + E_rx)
```

### **èƒ½é‡æ‰£é™¤**

```python
# æ£€æŸ¥ä¸­å¿ƒèƒ½é‡æ˜¯å¦è¶³å¤Ÿ
if physical_center.current_energy < center_energy_cost:
    print("[æŒ‡ä»¤ä¸‹å‘] è­¦å‘Šï¼šç‰©ç†ä¸­å¿ƒèƒ½é‡ä¸è¶³ï¼")
    print(f"  - éœ€è¦èƒ½é‡: {center_energy_cost:.2f}J")
    print(f"  - å½“å‰èƒ½é‡: {physical_center.current_energy:.2f}J")
    print(f"  - æœ¬è½®ä¼ èƒ½å–æ¶ˆ")
    return 0.0, False

# æ‰£é™¤ä¸­å¿ƒèƒ½é‡
physical_center.current_energy -= center_energy_cost

# æ‰£é™¤å„èŠ‚ç‚¹çš„æ¥æ”¶èƒ½é‡
for node in notified_nodes:
    E_rx = node.energy_consumption(physical_center, command_size_bytes)
    node.current_energy = max(0.0, node.current_energy - E_rx)
```

---

## âœ… æµ‹è¯•éªŒè¯

### **æµ‹è¯•1: é…ç½®é¡¹ä¼ é€’**
- [OK] `enable_command_downlink`é»˜è®¤ä¸º`True`
- [OK] `command_packet_size`é»˜è®¤ä¸º`1 B`
- [OK] é…ç½®æ­£ç¡®ä¼ é€’åˆ°`EnergySimulation`

### **æµ‹è¯•2: æŒ‡ä»¤ä¸‹å‘èƒ½é‡è®¡ç®—**
- [OK] æ­£ç¡®æ”¶é›†æ‰€æœ‰å‚ä¸èŠ‚ç‚¹
- [OK] æ­£ç¡®è®¡ç®—E_txå’ŒE_rx
- [OK] åŒå‘æ‰£é™¤èƒ½é‡ï¼ˆä¸­å¿ƒå’ŒèŠ‚ç‚¹ï¼‰
- [OK] èŠ‚ç‚¹èƒ½é‡ç¡®å®è¢«æ‰£é™¤

### **æµ‹è¯•3: ä¸­å¿ƒèƒ½é‡ä¸è¶³æ—¶å–æ¶ˆä¼ èƒ½**
- [OK] ä¸­å¿ƒèƒ½é‡ä¸è¶³æ—¶è¿”å›`success=False`
- [OK] ä¼ èƒ½è®¡åˆ’è¢«æ­£ç¡®å–æ¶ˆ

### **æµ‹è¯•4: èŠ‚ç‚¹å»é‡åŠŸèƒ½**
- [OK] åŒä¸€èŠ‚ç‚¹åœ¨å¤šä¸ªplanä¸­åªè®¡ç®—ä¸€æ¬¡
- [OK] æµ‹è¯•åœºæ™¯ï¼š5ä¸ªä¸åŒèŠ‚ç‚¹ï¼Œæ­£ç¡®å»é‡

**æµ‹è¯•ç»“æœ**: æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

## ğŸ“Š èƒ½é‡å¼€é”€åˆ†æ

### **å…¸å‹åœºæ™¯ä¼°ç®—**

å‡è®¾ï¼š
- 30èŠ‚ç‚¹ç½‘ç»œ
- æ¯è½®ç”Ÿæˆ10æ¡ä¼ èƒ½è®¡åˆ’
- æ¯æ¡planå¹³å‡æ¶‰åŠ3ä¸ªèŠ‚ç‚¹ï¼ˆdonor, receiver, 1ä¸ªrelayï¼‰
- æŒ‡ä»¤åŒ…å¤§å°ï¼š1B = 8bits
- å¹³å‡é€šä¿¡è·ç¦»ï¼š50m

**æ¯è½®æŒ‡ä»¤ä¸‹å‘èƒ½é‡**ï¼š
```
å»é‡åèŠ‚ç‚¹æ•°: ~15-20ä¸ªèŠ‚ç‚¹

å•æ¬¡é€šä¿¡èƒ½é‡ï¼ˆä¼°ç®—ï¼‰:
E_tx â‰ˆ E_elec Ã— bits + Îµ_amp Ã— bits Ã— d^2
E_tx â‰ˆ 1e-4 Ã— 8 + 1e-5 Ã— 8 Ã— 50^2
E_tx â‰ˆ 0.0008 + 0.2 = 0.2008 J

E_rx â‰ˆ E_elec Ã— bits
E_rx â‰ˆ 1e-4 Ã— 8 = 0.0008 J

åŒå‘èƒ½é‡ â‰ˆ 0.2016 J/èŠ‚ç‚¹

æ€»èƒ½é‡/è½® â‰ˆ 0.2016 Ã— 18 â‰ˆ 3.6 J
```

**é•¿æœŸå½±å“**ï¼š
```
ä»¿çœŸæ—¶é•¿: 10080åˆ†é’Ÿ (7å¤©)
ä¼ èƒ½é—´éš”: 60åˆ†é’Ÿ
æ€»è½®æ•°: 168è½®

ç´¯è®¡æŒ‡ä»¤ä¸‹å‘èƒ½é‡ â‰ˆ 3.6 Ã— 168 â‰ˆ 605 J

ç›¸æ¯”ç‰©ç†ä¸­å¿ƒåˆå§‹èƒ½é‡ï¼ˆ400000 Jï¼‰ï¼š
605 / 400000 â‰ˆ 0.15%
```

**ç»“è®º**: æŒ‡ä»¤ä¸‹å‘èƒ½é‡å¼€é”€ç›¸å¯¹è¾ƒå°ä½†ç´¯ç§¯å¯è§‚ï¼Œé•¿æœŸè¿è¡Œä¼šå½±å“ä¸­å¿ƒèƒ½é‡ã€‚

---

## ğŸ¯ å®ç°ç‰¹æ€§

### **ä¼˜ç‚¹** âœ…
1. **ç®€å•é«˜æ•ˆ**: åªè®¡ç®—èƒ½é‡ï¼Œä¸æ¨¡æ‹Ÿå¤æ‚é€šä¿¡è¿‡ç¨‹
2. **åŒå‘è®¡è´¦**: çœŸå®åæ˜ é€šä¿¡èƒ½é‡æ¶ˆè€—ï¼ˆå‘é€+æ¥æ”¶ï¼‰
3. **çµæ´»é…ç½®**: å¯é€šè¿‡é…ç½®å¼€å…³
4. **è‡ªåŠ¨å»é‡**: é¿å…é‡å¤è®¡ç®—
5. **å¤±è´¥ä¿æŠ¤**: èƒ½é‡ä¸è¶³æ—¶è‡ªåŠ¨å–æ¶ˆä¼ èƒ½
6. **å…¼å®¹æ€§å¥½**: ä¸æ”¹å˜ç°æœ‰æ‰§è¡Œæµç¨‹

### **å±€é™** âš ï¸
1. **ä¸æ¨¡æ‹Ÿå»¶è¿Ÿ**: å‡è®¾æŒ‡ä»¤ç¬é—´åˆ°è¾¾
2. **ä¸è€ƒè™‘ä¸¢åŒ…**: å‡è®¾é€šä¿¡100%æˆåŠŸ
3. **ä¸æ¨¡æ‹Ÿé˜Ÿåˆ—**: å‡è®¾èŠ‚ç‚¹ç«‹å³å¤„ç†æŒ‡ä»¤
4. **ç»Ÿä¸€åŒ…å¤§å°**: æ‰€æœ‰èŠ‚ç‚¹æ”¶åˆ°ç›¸åŒå¤§å°æŒ‡ä»¤

è¿™äº›å±€é™ç¬¦åˆæ–¹æ¡ˆ1çš„è®¾è®¡ç›®æ ‡ï¼ˆç®€åŒ–æ¨¡å‹ï¼‰ï¼Œæœªæ¥å¯é€šè¿‡æ–¹æ¡ˆ2/3æ‰©å±•ã€‚

---

## ğŸ“‚ ä¿®æ”¹æ–‡ä»¶æ±‡æ€»

### **æ ¸å¿ƒä»£ç ** (2ä¸ªæ–‡ä»¶)
1. **`src/config/simulation_config.py`**
   - æ–°å¢é…ç½®é¡¹ï¼š`enable_command_downlink`, `command_packet_size`
   - æ–°å¢å‚æ•°ä¼ é€’é€»è¾‘

2. **`src/core/energy_simulation.py`**
   - æ–°å¢æ–¹æ³•ï¼š`calculate_command_downlink_energy()`
   - æ–°å¢å‚æ•°ï¼š`enable_command_downlink`, `command_packet_size`
   - é›†æˆæŒ‡ä»¤ä¸‹å‘åˆ°æ‰§è¡Œæµç¨‹

### **ä»£ç ç»Ÿè®¡**
- **æ–°å¢ä»£ç **: ~130è¡Œ
- **ä¿®æ”¹ä»£ç **: ~20è¡Œ
- **æ€»è®¡**: ~150è¡Œ

---

## ğŸ”„ ä½¿ç”¨æ–¹å¼

### **é»˜è®¤å¯ç”¨**
```python
# ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆå·²å¯ç”¨æŒ‡ä»¤ä¸‹å‘ï¼‰
config = ConfigManager()
simulation = config.create_energy_simulation(network, scheduler)
simulation.simulate()  # è‡ªåŠ¨è®¡ç®—æŒ‡ä»¤ä¸‹å‘èƒ½é‡
```

### **å…³é—­æŒ‡ä»¤ä¸‹å‘**
```python
# åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®
{
    "simulation": {
        "enable_command_downlink": false
    }
}
```

æˆ–ä»£ç ä¸­ï¼š
```python
config.simulation_config.enable_command_downlink = False
```

### **è‡ªå®šä¹‰åŒ…å¤§å°**
```python
config.simulation_config.command_packet_size = 2  # 2å­—èŠ‚
```

---

## ğŸ“ ä¸‹ä¸€æ­¥æ‰©å±•

å¦‚éœ€å®ç°æ›´å®Œæ•´çš„åˆ†å¸ƒå¼æ§åˆ¶æ¨¡å‹ï¼ˆæ–¹æ¡ˆ2/3ï¼‰ï¼Œå¯ä»¥æ‰©å±•ï¼š

1. **æŒ‡ä»¤å†…å®¹å»ºæ¨¡**
   - å®šä¹‰æŒ‡ä»¤æ•°æ®ç»“æ„
   - åŒ…å«è·¯å¾„ä¿¡æ¯ã€è§’è‰²ä¿¡æ¯ã€èƒ½é‡å€¼ç­‰

2. **ä¼ è¾“å»¶è¿Ÿæ¨¡æ‹Ÿ**
   - åŸºäºè·ç¦»è®¡ç®—å»¶è¿Ÿ
   - èŠ‚ç‚¹çŠ¶æ€å¯èƒ½åœ¨å»¶è¿ŸæœŸé—´æ”¹å˜

3. **ä¸¢åŒ…å¤„ç†**
   - é€šä¿¡å¤±è´¥æ¦‚ç‡
   - é‡ä¼ æœºåˆ¶

4. **é˜Ÿåˆ—ç®¡ç†**
   - èŠ‚ç‚¹æŒ‡ä»¤é˜Ÿåˆ—
   - å¹¶å‘æ‰§è¡Œå¤šä¸ªplan

5. **ç¡®è®¤æœºåˆ¶**
   - èŠ‚ç‚¹æ”¶åˆ°æŒ‡ä»¤åå‘é€ACK
   - ä¸­å¿ƒç¡®è®¤åæ‰å¼€å§‹ä¼ èƒ½

---

**å®ç°å®Œæˆæ—¶é—´**: 2025å¹´10æœˆ28æ—¥  
**æµ‹è¯•ç»“æœ**: æ‰€æœ‰æµ‹è¯•é€šè¿‡  
**åŠŸèƒ½çŠ¶æ€**: ç”Ÿäº§å°±ç»ª

---

## ğŸ‰ æ€»ç»“

æˆåŠŸå®ç°äº†**æ–¹æ¡ˆ1ï¼ˆèƒ½é‡è®¡è´¦ï¼‰**çš„æŒ‡ä»¤ä¸‹å‘åŠŸèƒ½ï¼š

- âœ… é…ç½®çµæ´»ï¼ˆå¯å¼€å…³ã€å¯è°ƒæ•´åŒ…å¤§å°ï¼‰
- âœ… åŒå‘èƒ½é‡æ‰£é™¤ï¼ˆä¸­å¿ƒE_tx + èŠ‚ç‚¹E_rxï¼‰
- âœ… è‡ªåŠ¨èŠ‚ç‚¹å»é‡
- âœ… èƒ½é‡ä¸è¶³ä¿æŠ¤
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… ä»£ç ç®€æ´é«˜æ•ˆ

è¯¥å®ç°ä¸ºå®Œæ•´çš„åˆ†å¸ƒå¼æ§åˆ¶æ¨¡å‹å¥ å®šäº†åŸºç¡€ï¼Œæœªæ¥å¯æ ¹æ®éœ€è¦é€æ­¥æ‰©å±•ä¸ºæ›´å¤æ‚çš„é€šä¿¡æ¨¡å‹ã€‚

---

## ğŸ“‹ æ¶æ„é‡æ„ï¼ˆ2025-10-28ï¼‰

### é‡æ„èƒŒæ™¯

åŸå§‹å®ç°ä¸­ï¼ŒæŒ‡ä»¤ä¸‹å‘é€»è¾‘å®Œå…¨åœ¨ `EnergySimulation` ç±»ä¸­å®ç°ï¼Œå¯¼è‡´èŒè´£åˆ†é…ä¸å¤Ÿæ¸…æ™°ã€‚`NodeInfoManager`ï¼ˆç‰©ç†ä¸­å¿ƒï¼‰åªè´Ÿè´£è¢«åŠ¨æ¥æ”¶ä¿¡æ¯ï¼Œç¼ºä¹ä¸»åŠ¨è¡Œä¸ºã€‚

### é‡æ„ç›®æ ‡

å°†æŒ‡ä»¤ä¸‹å‘åŠŸèƒ½ä» `EnergySimulation` è¿ç§»åˆ° `NodeInfoManager` ç±»ï¼Œå®ç°æ›´æ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œæ›´å¥½çš„é¢å‘å¯¹è±¡è®¾è®¡ã€‚

### é‡æ„å†…å®¹

#### 1. NodeInfoManager æ–°å¢æ–¹æ³•

- **`_collect_command_recipients(plans)`**: æ”¶é›†éœ€è¦æ¥æ”¶æŒ‡ä»¤çš„èŠ‚ç‚¹
- **`_execute_broadcast(physical_center_node, notified_nodes, command_packet_size)`**: æ‰§è¡ŒæŒ‡ä»¤å¹¿æ’­å¹¶æ‰£é™¤èƒ½é‡
- **`broadcast_commands(physical_center_node, plans, command_packet_size=1)`**: ç‰©ç†ä¸­å¿ƒå‘å‚ä¸èŠ‚ç‚¹å¹¿æ’­æ‰§è¡ŒæŒ‡ä»¤ï¼ˆå…¬å¼€æ¥å£ï¼‰

#### 2. EnergySimulation é‡æ„

- **`calculate_command_downlink_energy(physical_center, plans)`**: ç®€åŒ–ä¸ºå§”æ‰˜ç»™ NodeInfoManager æ‰§è¡Œ

### é‡æ„ä¼˜åŠ¿

| æ–¹é¢ | é‡æ„å‰ | é‡æ„å |
|------|--------|--------|
| èŒè´£åˆ†é… | EnergySimulationè´Ÿè´£ä¸€åˆ‡ | NodeInfoManagerè´Ÿè´£æŒ‡ä»¤ï¼ŒSimulationè´Ÿè´£è°ƒåº¦ |
| å°è£…æ€§ | è¾ƒå·®ï¼ˆé€»è¾‘åˆ†æ•£ï¼‰ | å¥½ï¼ˆé›†ä¸­åœ¨NodeInfoManagerï¼‰ |
| å¯è¯»æ€§ | ä¸€èˆ¬ | å¼ºï¼ˆ`nim.broadcast_commands`å¾ˆç›´è§‚ï¼‰ |
| å¯æµ‹è¯•æ€§ | ä¸€èˆ¬ | å¥½ï¼ˆå¯ä»¥ç‹¬ç«‹æµ‹è¯•broadcastï¼‰ |
| ä»£ç å¤ç”¨ | å·® | å¥½ï¼ˆå…¶ä»–åœ°æ–¹ä¹Ÿèƒ½ç”¨broadcastï¼‰ |
| OOPåŸåˆ™ | è¿åå•ä¸€èŒè´£ | ç¬¦åˆå•ä¸€èŒè´£ã€é«˜å†…èšä½è€¦åˆ |

### é‡æ„ç»“æœ

- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆåŒ…æ‹¬ç‹¬ç«‹æµ‹è¯•ã€å§”æ‰˜æµ‹è¯•ï¼‰
- âœ… ä»£ç æ›´åŠ ç®€æ´ï¼ˆåˆ é™¤äº†ä¸å¿…è¦çš„å…¼å®¹æ–¹æ³•ï¼‰
- âœ… æ¶æ„æ›´åŠ æ¸…æ™°åˆç†
- âœ… ç¬¦åˆé¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™

è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒï¼š**[æŒ‡ä»¤ä¸‹å‘é‡æ„æŠ¥å‘Š.md](./æŒ‡ä»¤ä¸‹å‘é‡æ„æŠ¥å‘Š.md)**

