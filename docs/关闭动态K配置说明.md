# å…³é—­åŠ¨æ€Ké…ç½®è¯´æ˜Ž

## ðŸ“Œ ä»€ä¹ˆæ˜¯åŠ¨æ€K

**Kå€¼** = æ¯ä¸ªæŽ¥æ”¶èŠ‚ç‚¹å¯ä»¥åŒæ—¶æŽ¥å—çš„æèƒ½è€…æ•°é‡ä¸Šé™

- **åŠ¨æ€K** (`enable_k_adaptation: true`): ç³»ç»Ÿæ ¹æ®ç½‘ç»œèƒ½é‡çŠ¶æ€è‡ªåŠ¨è°ƒæ•´Kå€¼
- **å›ºå®šK** (`enable_k_adaptation: false`): ä½¿ç”¨å›ºå®šçš„Kå€¼ï¼Œä¸è‡ªé€‚åº”è°ƒæ•´

## âœ… å¦‚ä½•å…³é—­åŠ¨æ€K

### æ–¹æ³•1: ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ˆæŽ¨èï¼‰

åˆ›å»ºæˆ–ä¿®æ”¹é…ç½®JSONæ–‡ä»¶ï¼š

```json
{
  "simulation": {
    "enable_k_adaptation": false,
    "fixed_k": 2
  }
}
```

**å‚æ•°è¯´æ˜Žï¼š**
- `enable_k_adaptation: false` - **å…³é—­åŠ¨æ€Kè‡ªé€‚åº”**
- `fixed_k: 2` - ä½¿ç”¨å›ºå®šKå€¼ï¼ˆå¯è®¾ç½®ä¸º1-24ä¹‹é—´ä»»æ„æ•´æ•°ï¼‰

### æ–¹æ³•2: ä»£ç ä¸­è®¾ç½®

```python
from config.simulation_config import ConfigManager

config = ConfigManager()
config.simulation_config.enable_k_adaptation = False  # å…³é—­åŠ¨æ€K
config.simulation_config.fixed_k = 2  # è®¾ç½®å›ºå®šKå€¼

network = config.create_network()
simulation = config.create_energy_simulation(network)
simulation.run()
```

### æ–¹æ³•3: YAMLé…ç½®æ–‡ä»¶

```yaml
simulation:
  enable_k_adaptation: false  # å…³é—­åŠ¨æ€K
  fixed_k: 2                  # å›ºå®šKå€¼
```

## ðŸŽ¯ Kå€¼è®¾ç½®å»ºè®®

| Kå€¼ | é€‚ç”¨åœºæ™¯ | ç‰¹ç‚¹ |
|-----|---------|------|
| K=1 | å°è§„æ¨¡ç½‘ç»œã€ç®€å•æµ‹è¯• | æ¯ä¸ªæŽ¥æ”¶èŠ‚ç‚¹åªèƒ½æœ‰1ä¸ªæèƒ½è€… |
| K=2 | ä¸­ç­‰è§„æ¨¡ç½‘ç»œã€é»˜è®¤æŽ¨è | å¹³è¡¡æ•ˆçŽ‡å’Œå¤æ‚åº¦ |
| K=3-5 | å¤§è§„æ¨¡ç½‘ç»œã€é«˜å¯†åº¦ | æ›´å¤šå¹¶è¡Œä¼ èƒ½ï¼Œèƒ½é‡åˆ†é…æ›´å‡è¡¡ |
| K=5+ | è¶…å¤§è§„æ¨¡ç½‘ç»œ | æœ€å¤§åŒ–å¹¶è¡Œåº¦ï¼Œä½†è®¡ç®—å¼€é”€å¢žåŠ  |

## ðŸ“ é…ç½®æ–‡ä»¶ç¤ºä¾‹

é¡¹ç›®å·²æä¾›ä»¥ä¸‹é…ç½®æ–‡ä»¶ï¼Œéƒ½å·²å…³é—­åŠ¨æ€Kï¼š

### 1. `config_fixed_k.json` - é€šç”¨å›ºå®šKé…ç½®

```json
{
  "simulation": {
    "enable_k_adaptation": false,
    "fixed_k": 2,
    "time_steps": 2000
  },
  "network": {
    "num_nodes": 50
  },
  "scheduler": {
    "scheduler_type": "LyapunovScheduler"
  }
}
```

**ä½¿ç”¨ï¼š**
```bash
python src/sim/refactored_main.py --config config_fixed_k.json
```

### 2. `config_gpu_example.json` - GPUåŠ é€Ÿ + å›ºå®šK

```json
{
  "simulation": {
    "use_gpu_acceleration": true,
    "enable_k_adaptation": false,
    "fixed_k": 5,
    "time_steps": 2000
  },
  "network": {
    "num_nodes": 200
  }
}
```

**ä½¿ç”¨ï¼š**
```bash
python src/sim/refactored_main.py --config config_gpu_example.json
```

### 3. `config_dqn_example.yaml` - DQNè°ƒåº¦å™¨ + å›ºå®šK

```yaml
simulation:
  enable_k_adaptation: false
  fixed_k: 2

scheduler:
  enable_dqn: true
  dqn_training_mode: false
```

**ä½¿ç”¨ï¼š**
```bash
python src/sim/refactored_main.py --config config_dqn_example.yaml
```

## ðŸ” éªŒè¯åŠ¨æ€Kæ˜¯å¦å·²å…³é—­

è¿è¡Œä»¿çœŸæ—¶ï¼ŒæŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼š

```bash
python src/sim/refactored_main.py --config config_fixed_k.json
```

**é¢„æœŸæ—¥å¿—ï¼š**
```
ä½¿ç”¨å›ºå®šKå€¼: 2
Kè‡ªé€‚åº”: å…³é—­
```

å¦‚æžœçœ‹åˆ°ç±»ä¼¼"Kå€¼è°ƒæ•´: 2 -> 3"çš„æ—¥å¿—ï¼Œè¯´æ˜ŽåŠ¨æ€Kä»ç„¶å¯ç”¨ã€‚

## âš™ï¸ åŠ¨æ€Kç›¸å…³é…ç½®å‚æ•°

å¦‚æžœ**éœ€è¦å¯ç”¨**åŠ¨æ€Kï¼ˆé»˜è®¤æƒ…å†µä¸‹å»ºè®®å…³é—­ï¼‰ï¼Œå¯ä»¥è®¾ç½®ï¼š

```json
{
  "simulation": {
    "enable_k_adaptation": true,
    "initial_K": 1,
    "K_max": 24,
    "hysteresis": 0.2,
    "w_b": 0.8,
    "w_d": 0.8,
    "w_l": 1.5,
    "use_lookahead": false
  }
}
```

**å‚æ•°è¯´æ˜Žï¼š**
- `initial_K`: åˆå§‹Kå€¼ï¼ˆèµ·ç‚¹ï¼‰
- `K_max`: Kå€¼ä¸Šé™ï¼ˆé¿å…è¿‡åº¦å¹¶è¡Œï¼‰
- `hysteresis`: æ»žå›žé˜ˆå€¼ï¼ˆé˜²æŠ–ï¼Œé¿å…é¢‘ç¹å˜åŒ–ï¼‰
- `w_b`: å‡è¡¡æ”¹è¿›æƒé‡
- `w_d`: æœ‰æ•ˆé€è¾¾é‡æƒé‡
- `w_l`: æŸè€—æƒ©ç½šæƒé‡
- `use_lookahead`: æ˜¯å¦ä½¿ç”¨å‰çž»è¯„ä¼°

## ðŸ’¡ å›ºå®šK vs åŠ¨æ€K

### âœ… å›ºå®šKçš„ä¼˜åŠ¿

1. **å¯é¢„æµ‹æ€§å¼º** - è¡Œä¸ºç¨³å®šï¼Œä¾¿äºŽåˆ†æž
2. **è®¡ç®—å¼€é”€ä½Ž** - æ— éœ€é¢å¤–çš„è‡ªé€‚åº”è®¡ç®—
3. **æ˜“äºŽè°ƒè¯•** - ç»“æžœæ›´å®¹æ˜“å¤çŽ°å’Œç†è§£
4. **é€‚åˆå¯¹æ¯”å®žéªŒ** - ä½œä¸ºåŸºçº¿æ›´å…¬å¹³

### åŠ¨æ€Kçš„ä¼˜åŠ¿

1. **è‡ªé€‚åº”èƒ½åŠ›** - æ ¹æ®ç½‘ç»œçŠ¶æ€åŠ¨æ€è°ƒæ•´
2. **å¯èƒ½æ›´ä¼˜** - ç†è®ºä¸Šå¯ä»¥æ‰¾åˆ°æ›´ä¼˜çš„Kå€¼
3. **çµæ´»æ€§é«˜** - é€‚åº”ä¸åŒç½‘ç»œæ¡ä»¶

### ðŸ“Š æŽ¨èä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æŽ¨èé…ç½® | ç†ç”± |
|------|---------|------|
| ç®—æ³•å¼€å‘/è°ƒè¯• | å›ºå®šK | è¡Œä¸ºå¯é¢„æµ‹ï¼Œæ˜“äºŽè°ƒè¯• |
| æ€§èƒ½å¯¹æ¯”å®žéªŒ | å›ºå®šK | ä¿è¯å…¬å¹³å¯¹æ¯” |
| å‚æ•°æ•æ„Ÿæ€§åˆ†æž | å›ºå®šK | éš”ç¦»Kçš„å½±å“ |
| è®ºæ–‡å®žéªŒ | å›ºå®šK | ç»“æžœæ›´å®¹æ˜“å¤çŽ° |
| å®žé™…éƒ¨ç½² | åŠ¨æ€Kï¼ˆå¯é€‰ï¼‰ | é€‚åº”å®žé™…çŽ¯å¢ƒå˜åŒ– |

## ðŸš€ å¿«é€Ÿå¼€å§‹

### åœºæ™¯1: å°è§„æ¨¡æµ‹è¯•ï¼ˆ50èŠ‚ç‚¹ï¼ŒK=2ï¼‰

```bash
python src/sim/refactored_main.py --config config_fixed_k.json
```

### åœºæ™¯2: å¤§è§„æ¨¡GPUåŠ é€Ÿï¼ˆ200èŠ‚ç‚¹ï¼ŒK=5ï¼‰

```bash
python src/sim/refactored_main.py --config config_gpu_example.json
```

### åœºæ™¯3: DQNè°ƒåº¦å™¨ï¼ˆK=2ï¼‰

```bash
python src/sim/refactored_main.py --config config_dqn_example.yaml
```

### åœºæ™¯4: è‡ªå®šä¹‰Kå€¼

```bash
# åˆ›å»ºä¸´æ—¶é…ç½®
cat > my_config.json << EOF
{
  "simulation": {
    "enable_k_adaptation": false,
    "fixed_k": 3
  },
  "network": {
    "num_nodes": 100
  }
}
EOF

# è¿è¡Œ
python src/sim/refactored_main.py --config my_config.json
```

## ðŸ› å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ç¡®è®¤åŠ¨æ€Kå·²å…³é—­ï¼Ÿ

**A:** æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­ï¼š
```json
"enable_k_adaptation": false
```

æˆ–æŸ¥çœ‹ä»¿çœŸæ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°"ä½¿ç”¨å›ºå®šKå€¼"è€Œä¸æ˜¯"Kå€¼è°ƒæ•´"ã€‚

### Q2: å›ºå®šKå€¼åº”è¯¥è®¾ç½®ä¸ºå¤šå°‘ï¼Ÿ

**A:** 
- **é»˜è®¤æŽ¨è**: K=2ï¼ˆé€‚åˆå¤§å¤šæ•°åœºæ™¯ï¼‰
- **å°ç½‘ç»œ**: K=1æˆ–2
- **å¤§ç½‘ç»œ**: K=3-5
- **å®žéªŒå¯¹æ¯”**: å°è¯•K=1,2,3,5è¿›è¡Œå¯¹æ¯”

### Q3: å¯ä»¥åœ¨è¿è¡Œæ—¶æ”¹å˜Kå€¼å—ï¼Ÿ

**A:** 
- **å›ºå®šKæ¨¡å¼**: ä¸ä¼šæ”¹å˜
- **åŠ¨æ€Kæ¨¡å¼**: ä¼šè‡ªåŠ¨è°ƒæ•´
- å¦‚éœ€æ”¹å˜ï¼Œéœ€è¦é‡æ–°è¿è¡Œä»¿çœŸ

### Q4: DQN/DDPGè°ƒåº¦å™¨éœ€è¦å…³é—­åŠ¨æ€Kå—ï¼Ÿ

**A:** 
- **æŽ¨èå…³é—­** - DQN/DDPGè‡ªå·±åšå†³ç­–
- åœ¨`config_dqn_example.yaml`ä¸­å·²è®¾ç½®ä¸º`false`
- è®©æ·±åº¦å­¦ä¹ è°ƒåº¦å™¨ç‹¬ç«‹æŽ§åˆ¶ç­–ç•¥

## ðŸ“ é…ç½®æ£€æŸ¥æ¸…å•

åœ¨è¿è¡Œä»¿çœŸå‰ï¼Œç¡®è®¤ï¼š

- [ ] `enable_k_adaptation: false` å·²è®¾ç½®
- [ ] `fixed_k` å€¼å·²è®¾ç½®ï¼ˆæŽ¨è2-5ï¼‰
- [ ] é…ç½®æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼ˆJSONæˆ–YAMLï¼‰
- [ ] å…¶ä»–ä»¿çœŸå‚æ•°å·²é…ç½®
- [ ] ä¿å­˜é…ç½®æ–‡ä»¶

## ðŸ“š ç›¸å…³æ–‡æ¡£

- `src/config/simulation_config.py` - å®Œæ•´é…ç½®å‚æ•°è¯´æ˜Ž
- `config_fixed_k.json` - å›ºå®šKé…ç½®ç¤ºä¾‹
- `config_gpu_example.json` - GPU + å›ºå®šKç¤ºä¾‹
- `config_dqn_example.yaml` - DQN + å›ºå®šKç¤ºä¾‹

## ðŸ”— ç›¸å…³é…ç½®

### è°ƒåº¦å™¨ä¸­çš„Kå‚æ•°

æ³¨æ„ï¼šè°ƒåº¦å™¨é…ç½®ä¸­ä¹Ÿæœ‰Kç›¸å…³å‚æ•°ï¼š

```json
{
  "scheduler": {
    "lyapunov_k": 3,  // Lyapunovè°ƒåº¦å™¨çš„Kå‚æ•°ï¼ˆä¸åŒäºŽå…¨å±€Kï¼‰
    "adaptive_k_max": 24  // è°ƒåº¦å™¨å†…éƒ¨çš„Kä¸Šé™
  }
}
```

è¿™äº›æ˜¯**è°ƒåº¦å™¨å†…éƒ¨ä½¿ç”¨çš„K**ï¼Œä¸Žå…¨å±€åŠ¨æ€Kæ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚

---

**é»˜è®¤çŠ¶æ€**: åŠ¨æ€Kå·²å…³é—­ï¼ˆ`enable_k_adaptation: false`ï¼‰  
**æŽ¨èé…ç½®**: ä½¿ç”¨å›ºå®šK=2  
**æœ€åŽæ›´æ–°**: 2025-11-04


