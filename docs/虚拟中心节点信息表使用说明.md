# è™šæ‹Ÿä¸­å¿ƒèŠ‚ç‚¹ä¿¡æ¯è¡¨ä½¿ç”¨è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

è™šæ‹Ÿä¸­å¿ƒç°åœ¨é›†æˆäº†ä¸€ä¸ª**ä¸‰çº§ç¼“å­˜çš„èŠ‚ç‚¹ä¿¡æ¯è¡¨**ï¼Œç”¨äºè®°å½•å’Œç®¡ç†æ‰€æœ‰èŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- èŠ‚ç‚¹ç¼–å·
- å½“å‰èƒ½é‡
- ä¿¡æ¯æ–°é²œåº¦ï¼ˆé‡‡é›†æ—¶é—´ï¼‰
- ä¿¡æ¯åˆ°è¾¾è™šæ‹Ÿä¸­å¿ƒçš„æ—¶é—´
- èŠ‚ç‚¹ä½ç½®ã€å¤ªé˜³èƒ½çŠ¶æ€ã€ç°‡IDç­‰æ‰©å±•ä¿¡æ¯

---

## ğŸ—ï¸ ä¸‰çº§ç¼“å­˜æ¶æ„ï¼ˆæ–¹æ¡ˆ3ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L1: æœ€æ–°çŠ¶æ€è¡¨ï¼ˆlatest_infoï¼‰                       â”‚
â”‚  â€¢ æ•°æ®ç»“æ„: Dict[node_id, info_dict]                â”‚
â”‚  â€¢ æŸ¥è¯¢å¤æ‚åº¦: O(1)                                   â”‚
â”‚  â€¢ ç”¨é€”: å¿«é€Ÿè·å–èŠ‚ç‚¹æœ€æ–°çŠ¶æ€                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L2: è¿‘æœŸå†å²ï¼ˆrecent_historyï¼‰                      â”‚
â”‚  â€¢ æ•°æ®ç»“æ„: deque(maxlen=1000)                      â”‚
â”‚  â€¢ ç”¨é€”: æ—¶åºåˆ†æã€è¶‹åŠ¿è¿½è¸ª                           â”‚
â”‚  â€¢ ç‰¹æ€§: å›ºå®šå¤§å°ï¼Œè‡ªåŠ¨æ·˜æ±°æ—§è®°å½•                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L3: é•¿æœŸå½’æ¡£ï¼ˆCSVæ–‡ä»¶ï¼‰                             â”‚
â”‚  â€¢ æ–‡ä»¶è·¯å¾„: data/[session]/virtual_center_node_info.csv â”‚
â”‚  â€¢ æ‰¹é‡å†™å…¥: æ¯100æ¡è®°å½•æ‰¹é‡åˆ·æ–°                      â”‚
â”‚  â€¢ ç”¨é€”: æŒä¹…åŒ–å­˜å‚¨ã€ç¦»çº¿åˆ†æ                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š èŠ‚ç‚¹ä¿¡æ¯è¡¨ç»“æ„

### L1: æœ€æ–°çŠ¶æ€è¡¨

```python
{
    node_id: {
        'energy': float,           # èŠ‚ç‚¹å½“å‰èƒ½é‡ï¼ˆJï¼‰
        'freshness': int,          # ä¿¡æ¯é‡‡é›†æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
        'arrival_time': int,       # åˆ°è¾¾è™šæ‹Ÿä¸­å¿ƒæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
        'position': (x, y),        # èŠ‚ç‚¹ä½ç½®åæ ‡
        'is_solar': bool,          # æ˜¯å¦æœ‰å¤ªé˜³èƒ½
        'cluster_id': int,         # æ‰€å±ç°‡ID
        'data_size': int,          # æ•°æ®åŒ…å¤§å°ï¼ˆbitsï¼‰
        'age': int                 # ä¿¡æ¯å¹´é¾„ = arrival_time - freshness
    }
}
```

### L3: å½’æ¡£CSVæ–‡ä»¶

| åˆ—å | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `arrival_time` | int | åˆ°è¾¾è™šæ‹Ÿä¸­å¿ƒæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ |
| `node_id` | int | èŠ‚ç‚¹ID |
| `energy` | float | èŠ‚ç‚¹èƒ½é‡ï¼ˆJï¼‰ |
| `freshness` | int | ä¿¡æ¯é‡‡é›†æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ |
| `age` | int | ä¿¡æ¯å¹´é¾„ï¼ˆåˆ†é’Ÿï¼‰ |
| `position_x` | float | Xåæ ‡ |
| `position_y` | float | Yåæ ‡ |
| `is_solar` | bool | æ˜¯å¦æœ‰å¤ªé˜³èƒ½ |
| `cluster_id` | int | æ‰€å±ç°‡ID |
| `data_size` | int | æ•°æ®åŒ…å¤§å°ï¼ˆbitsï¼‰ |

---

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. è‡ªåŠ¨é›†æˆï¼ˆæ— éœ€ä¿®æ”¹ä»£ç ï¼‰

èŠ‚ç‚¹ä¿¡æ¯è¡¨å·²ç»é›†æˆåˆ°ADCRåè®®ä¸­ï¼Œ**è‡ªåŠ¨è¿è¡Œ**ï¼š

```python
# è¿è¡Œä»¿çœŸï¼ˆæ­£å¸¸æµç¨‹ï¼‰
python src/sim/refactored_main.py

# è‡ªåŠ¨å‘ç”Ÿçš„äº‹æƒ…ï¼š
# 0. ADCRåˆ›å»ºæ—¶ï¼šç«‹å³å¡«å……æ‰€æœ‰èŠ‚ç‚¹çš„åˆå§‹çŠ¶æ€ï¼ˆt=0ï¼‰âœ¨ æ–°å¢
# 1. ADCRæ¯24å°æ—¶æ‰§è¡Œä¸€æ¬¡
# 2. é€šä¿¡ç»“ç®—åï¼Œè‡ªåŠ¨æ›´æ–°æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯åˆ°è™šæ‹Ÿä¸­å¿ƒ
# 3. æ¯100æ¡è®°å½•è‡ªåŠ¨æ‰¹é‡å†™å…¥CSVæ–‡ä»¶
# 4. ä»¿çœŸç»“æŸæ—¶å¼ºåˆ¶åˆ·æ–°å‰©ä½™è®°å½•
```

**åˆå§‹å€¼è‡ªåŠ¨å¡«å……ï¼š**
- âœ… ADCRåˆ›å»ºåç«‹å³å¡«å……æ‰€æœ‰èŠ‚ç‚¹åˆå§‹ä¿¡æ¯
- âœ… ä½¿ç”¨ `node.initial_energy` ä½œä¸ºåˆå§‹èƒ½é‡
- âœ… æ—¶é—´æˆ³è®¾ä¸º t=0
- âœ… åˆå§‹æ—¶æ— ç°‡åˆ†é…ï¼ˆcluster_id=Noneï¼‰

### 2. æ‰‹åŠ¨æ›´æ–°å•ä¸ªèŠ‚ç‚¹

```python
# åœ¨ADCRæˆ–å…¶ä»–æ¨¡å—ä¸­æ‰‹åŠ¨æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯
adcr.vc.update_node_info(
    node_id=5,
    energy=1200.5,
    freshness=1440,      # ç¬¬1å¤©ç»“æŸ
    arrival_time=1440,   # åŒæ—¶åˆ°è¾¾
    position=(5.0, 5.0),
    is_solar=True,
    cluster_id=2,
    data_size=5000
)
```

### 3. æ‰¹é‡æ›´æ–°æ‰€æœ‰èŠ‚ç‚¹

```python
# æ‰¹é‡æ›´æ–°ï¼ˆADCRè‡ªåŠ¨è°ƒç”¨ï¼‰
adcr.vc.batch_update_node_info(
    nodes=network.nodes,
    current_time=t,
    cluster_mapping=adcr.cluster_of,  # {node_id: cluster_id}
    data_sizes={ch_id: data_size}     # {node_id: data_size}
)
```

---

## ğŸ“– æŸ¥è¯¢æ¥å£

### 1. è·å–å•ä¸ªèŠ‚ç‚¹æœ€æ–°ä¿¡æ¯

```python
# æŸ¥è¯¢Node 5çš„æœ€æ–°ä¿¡æ¯
info = adcr.vc.get_node_info(5)

if info:
    print(f"Node 5 èƒ½é‡: {info['energy']}J")
    print(f"ä¿¡æ¯å¹´é¾„: {info['age']}åˆ†é’Ÿ")
    print(f"æ‰€å±ç°‡: {info['cluster_id']}")

# åœ¨ä»¿çœŸå¼€å§‹å‰å°±å¯ä»¥æŸ¥è¯¢åˆå§‹å€¼ âœ¨
# å› ä¸ºADCRåˆ›å»ºæ—¶å·²ç»å¡«å……äº†æ‰€æœ‰èŠ‚ç‚¹çš„åˆå§‹ä¿¡æ¯
# ä¾‹å¦‚åœ¨ t=0 æ—¶ï¼š
# info['energy'] = node.initial_energy (å¦‚ 40000.0)
# info['freshness'] = 0
# info['cluster_id'] = None
```

### 2. è·å–æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯

```python
# è·å–æ‰€æœ‰èŠ‚ç‚¹çš„æœ€æ–°çŠ¶æ€
all_info = adcr.vc.get_all_nodes_info()

for node_id, info in all_info.items():
    print(f"Node {node_id}: {info['energy']:.1f}J, ç°‡{info['cluster_id']}")
```

### 3. è·å–ä¿¡æ¯è¿‡æœŸçš„èŠ‚ç‚¹

```python
# è·å–ä¿¡æ¯å¹´é¾„è¶…è¿‡30åˆ†é’Ÿçš„èŠ‚ç‚¹
stale_nodes = adcr.vc.get_stale_nodes(
    current_time=1500,
    staleness_threshold=30  # 30åˆ†é’Ÿ
)

print(f"è¿‡æœŸèŠ‚ç‚¹: {stale_nodes}")
```

### 4. è·å–ä½èƒ½é‡èŠ‚ç‚¹

```python
# è·å–èƒ½é‡ä½äº1000Jçš„èŠ‚ç‚¹
low_energy_nodes = adcr.vc.get_low_energy_nodes(
    energy_threshold=1000.0
)

# è¿”å›: [(node_id, energy), ...] æŒ‰èƒ½é‡å‡åºæ’åº
for node_id, energy in low_energy_nodes:
    print(f"Node {node_id}: {energy:.1f}J")
```

### 5. è·å–ç»Ÿè®¡ä¿¡æ¯

```python
# è·å–æ•´ä½“ç»Ÿè®¡
stats = adcr.vc.get_statistics()

print(f"èŠ‚ç‚¹æ€»æ•°: {stats['total_nodes']}")
print(f"å¹³å‡èƒ½é‡: {stats['avg_energy']:.1f}J")
print(f"æœ€ä½èƒ½é‡: {stats['min_energy']:.1f}J")
print(f"å¹³å‡ä¿¡æ¯å¹´é¾„: {stats['avg_age']:.1f}åˆ†é’Ÿ")
print(f"å¤ªé˜³èƒ½èŠ‚ç‚¹: {stats['solar_nodes']}")
print(f"å†å²è®°å½•: {stats['history_records']}")
```

### 6. è·å–å†å²è®°å½•

```python
# è·å–æœ€è¿‘100æ¡å†å²è®°å½•
history = adcr.vc.get_recent_history(limit=100)

for record in history:
    arrival_time, node_id, energy, freshness, position, is_solar, cluster_id, data_size = record
    print(f"[{arrival_time}] Node {node_id}: {energy:.1f}J")
```

---

## ğŸ“‚ è¾“å‡ºæ–‡ä»¶

### å½’æ¡£æ–‡ä»¶ä½ç½®

```
data/
â””â”€â”€ 20251027_120000/              # ä¼šè¯ç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
    â”œâ”€â”€ virtual_center_node_info.csv  # â† èŠ‚ç‚¹ä¿¡æ¯è¡¨å½’æ¡£
    â”œâ”€â”€ energy_over_time.png
    â”œâ”€â”€ node_distribution.png
    â””â”€â”€ simulation_results.csv
```

### å½’æ¡£æ–‡ä»¶ç¤ºä¾‹

```csv
arrival_time,node_id,energy,freshness,age,position_x,position_y,is_solar,cluster_id,data_size
0,0,40000.0,0,0,1.5,2.3,True,,,                # â† åˆå§‹å€¼ï¼ˆt=0ï¼‰âœ¨
0,1,40000.0,0,0,3.7,4.1,False,,,               # â† åˆå§‹å€¼ï¼ˆt=0ï¼‰âœ¨
0,2,40000.0,0,0,6.2,1.8,True,,,                # â† åˆå§‹å€¼ï¼ˆt=0ï¼‰âœ¨
1440,0,38500.2,1440,0,1.5,2.3,True,0,5000     # â† ç¬¬1æ¬¡ADCRæ›´æ–°
1440,1,38120.5,1440,0,3.7,4.1,False,0,5000    # â† ç¬¬1æ¬¡ADCRæ›´æ–°
1440,2,39800.0,1440,0,6.2,1.8,True,1,8000     # â† ç¬¬1æ¬¡ADCRæ›´æ–°
2880,0,37200.3,2880,0,1.5,2.3,True,0,5000     # â† ç¬¬2æ¬¡ADCRæ›´æ–°
2880,1,36850.5,2880,0,3.7,4.1,False,0,5000    # â† ç¬¬2æ¬¡ADCRæ›´æ–°
...
```

**è¯´æ˜ï¼š**
- ç¬¬ä¸€æ‰¹è®°å½•ï¼ˆt=0ï¼‰ï¼šç½‘ç»œåˆ›å»ºæ—¶çš„åˆå§‹çŠ¶æ€ï¼Œæ‰€æœ‰èŠ‚ç‚¹èƒ½é‡ä¸ºåˆå§‹å€¼
- åç»­è®°å½•ï¼šADCRæ¯24å°æ—¶æ›´æ–°ä¸€æ¬¡ï¼Œè®°å½•èƒ½é‡å˜åŒ–å’Œç°‡åˆ†é…

---

## ğŸ¯ åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šç½‘ç»œçŠ¶æ€ç›‘æ§

```python
# ç›‘æ§ç½‘ç»œæ•´ä½“å¥åº·åº¦
stats = adcr.vc.get_statistics()

if stats['min_energy'] < 100:
    print("âš ï¸ è­¦å‘Šï¼šæœ‰èŠ‚ç‚¹èƒ½é‡è¿‡ä½ï¼")
    
if stats['avg_age'] > 60:
    print("âš ï¸ è­¦å‘Šï¼šä¿¡æ¯æ›´æ–°æ»åï¼")
```

### åœºæ™¯2ï¼šæ™ºèƒ½è°ƒåº¦å†³ç­–

```python
# åŸºäºè™šæ‹Ÿä¸­å¿ƒçš„ä¿¡æ¯è¿›è¡Œè°ƒåº¦å†³ç­–
def schedule_based_on_vc_info(vc, current_time):
    # 1. è·å–ä½èƒ½é‡èŠ‚ç‚¹
    low_energy = vc.get_low_energy_nodes(threshold=500)
    
    # 2. æ’é™¤ä¿¡æ¯è¿‡æœŸçš„èŠ‚ç‚¹
    stale = set(vc.get_stale_nodes(current_time, staleness_threshold=30))
    
    # 3. ç­›é€‰æœ‰æ•ˆç›®æ ‡
    valid_targets = [(nid, e) for nid, e in low_energy if nid not in stale]
    
    return valid_targets
```

### åœºæ™¯3ï¼šä¿¡æ¯æ–°é²œåº¦åˆ†æ

```python
# åˆ†æä¿¡æ¯å»¶è¿Ÿ
all_info = adcr.vc.get_all_nodes_info()

ages = [info['age'] for info in all_info.values()]
print(f"ä¿¡æ¯å¹´é¾„ç»Ÿè®¡ï¼š")
print(f"  æœ€å°: {min(ages)}åˆ†é’Ÿ")
print(f"  å¹³å‡: {sum(ages)/len(ages):.1f}åˆ†é’Ÿ")
print(f"  æœ€å¤§: {max(ages)}åˆ†é’Ÿ")
```

### åœºæ™¯4ï¼šç¦»çº¿æ•°æ®åˆ†æ

```python
import pandas as pd

# è¯»å–å½’æ¡£æ–‡ä»¶
df = pd.read_csv("data/20251027_120000/virtual_center_node_info.csv")

# åˆ†æèƒ½é‡å˜åŒ–è¶‹åŠ¿
node_0_energy = df[df['node_id'] == 0]['energy']
print(f"Node 0 èƒ½é‡å˜åŒ–: {node_0_energy.describe()}")

# åˆ†æä¿¡æ¯å»¶è¿Ÿåˆ†å¸ƒ
print(f"ä¿¡æ¯å¹´é¾„åˆ†å¸ƒ:\n{df['age'].describe()}")

# å¯è§†åŒ–
import matplotlib.pyplot as plt
df.groupby('arrival_time')['energy'].mean().plot()
plt.title('å¹³å‡èƒ½é‡éšæ—¶é—´å˜åŒ–')
plt.show()
```

---

## âš™ï¸ é…ç½®å‚æ•°

### VirtualCenteråˆå§‹åŒ–å‚æ•°

```python
vc = VirtualCenter(
    initial_position=(5.0, 5.0),       # åˆå§‹ä½ç½®
    update_strategy="geometric_center", # ä½ç½®æ›´æ–°ç­–ç•¥
    enable_logging=True,                # æ˜¯å¦å¯ç”¨æ—¥å¿—
    history_size=1000,                  # L2ç¼“å­˜å¤§å°ï¼ˆæ¡ï¼‰
    archive_path="data/vc_info.csv"     # L3å½’æ¡£è·¯å¾„
)
```

### æ‰¹é‡å†™å…¥é…ç½®

```python
# ä¿®æ”¹æ‰¹é‡å†™å…¥å¤§å°ï¼ˆé»˜è®¤100ï¼‰
vc.archive_batch_size = 200  # æ¯200æ¡è®°å½•å†™å…¥ä¸€æ¬¡
```

---

## ğŸ” è°ƒè¯•ä¿¡æ¯

### å¯ç”¨è¯¦ç»†æ—¥å¿—

```python
# VirtualCenter å·²é»˜è®¤å¯ç”¨æ—¥å¿—
# å®Œæ•´çš„æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹ï¼š

# ========== ADCRåˆ›å»ºæ—¶ï¼ˆåˆå§‹åŒ–ï¼‰ ==========
# [ADCR] åˆå§‹åŒ–è™šæ‹Ÿä¸­å¿ƒèŠ‚ç‚¹ä¿¡æ¯è¡¨...
# [VirtualCenter] å¼€å§‹åˆå§‹åŒ–èŠ‚ç‚¹ä¿¡æ¯è¡¨ï¼ŒèŠ‚ç‚¹æ•°: 30
# [VirtualCenter] æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯: Node 0, èƒ½é‡=40000.0J, æ–°é²œåº¦=0, åˆ°è¾¾æ—¶é—´=0, ä¿¡æ¯å¹´é¾„=0åˆ†é’Ÿ
# [VirtualCenter] æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯: Node 1, èƒ½é‡=40000.0J, æ–°é²œåº¦=0, åˆ°è¾¾æ—¶é—´=0, ä¿¡æ¯å¹´é¾„=0åˆ†é’Ÿ
# ... (æ‰€æœ‰èŠ‚ç‚¹)
# [VirtualCenter] èŠ‚ç‚¹ä¿¡æ¯è¡¨åˆå§‹åŒ–å®Œæˆï¼Œè®°å½•æ•°: 30
# [VirtualCenter] åˆå§‹ç»Ÿè®¡ - å¹³å‡èƒ½é‡: 40000.0J, å¤ªé˜³èƒ½èŠ‚ç‚¹: 18/30
# [ADCR] è™šæ‹Ÿä¸­å¿ƒèŠ‚ç‚¹ä¿¡æ¯è¡¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è®°å½• 30 ä¸ªèŠ‚ç‚¹

# ========== ADCRæ‰§è¡Œæ—¶ï¼ˆæ¯24å°æ—¶æ›´æ–°ï¼‰ ==========
# [VirtualCenter] æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯: Node 5, èƒ½é‡=38500.2J, æ–°é²œåº¦=1440, åˆ°è¾¾æ—¶é—´=1440, ä¿¡æ¯å¹´é¾„=0åˆ†é’Ÿ
# [VirtualCenter] æ‰¹é‡æ›´æ–° 30 ä¸ªèŠ‚ç‚¹ä¿¡æ¯
# [VirtualCenter] å½’æ¡£ 100 æ¡è®°å½•åˆ° data/20251027_120000/virtual_center_node_info.csv
# [ADCR] è™šæ‹Ÿä¸­å¿ƒèŠ‚ç‚¹ä¿¡æ¯è¡¨å·²æ›´æ–°ï¼Œå½“å‰è®°å½•: 30 ä¸ªèŠ‚ç‚¹

# ========== ä»¿çœŸç»“æŸæ—¶ ==========
# [VirtualCenter] å¼ºåˆ¶åˆ·æ–°å½’æ¡£å®Œæˆ
# [ADCR] è™šæ‹Ÿä¸­å¿ƒå½’æ¡£å·²ä¿å­˜
```

### æŸ¥çœ‹å½“å‰çŠ¶æ€

```python
# æŸ¥çœ‹å†…å­˜å ç”¨æƒ…å†µ
stats = vc.get_statistics()
print(f"L1 è®°å½•æ•°: {stats['total_nodes']}")
print(f"L2 è®°å½•æ•°: {stats['history_records']}")
print(f"L3 ç¼“å†²åŒº: {stats['archive_buffer_size']}")
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å®šæœŸå¼ºåˆ¶åˆ·æ–°

```python
# åœ¨é‡è¦æ—¶åˆ»å¼ºåˆ¶åˆ·æ–°å½’æ¡£
if t % 1440 == 0:  # æ¯å¤©ç»“æŸæ—¶
    vc.force_flush_archive()
```

### 2. å†…å­˜ç®¡ç†

```python
# å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„ä»¿çœŸï¼Œæ§åˆ¶L2ç¼“å­˜å¤§å°
vc = VirtualCenter(
    history_size=500,  # å‡å°åˆ°500æ¡
    archive_batch_size=50  # æ›´é¢‘ç¹åœ°å†™å…¥ç£ç›˜
)
```

### 3. æ€§èƒ½ä¼˜åŒ–

```python
# å¯¹äºå¤§è§„æ¨¡ç½‘ç»œï¼ˆ>1000èŠ‚ç‚¹ï¼‰
# å»ºè®®ï¼š
# - history_size = 500
# - archive_batch_size = 50
# - ç¦ç”¨è¯¦ç»†æ—¥å¿—ï¼šenable_logging=False
```

### 4. æ•°æ®åˆ†æ

```python
# ä»¿çœŸç»“æŸååˆ†æ
import pandas as pd

df = pd.read_csv("data/latest/virtual_center_node_info.csv")

# æŒ‰ç°‡åˆ†ç»„åˆ†æ
cluster_stats = df.groupby('cluster_id').agg({
    'energy': ['mean', 'std', 'min', 'max'],
    'age': ['mean', 'max']
})
print(cluster_stats)
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æ“ä½œ | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ |
|------|-----------|-----------|
| æ›´æ–°å•ä¸ªèŠ‚ç‚¹ | O(1) | O(1) |
| æ‰¹é‡æ›´æ–°Nä¸ªèŠ‚ç‚¹ | O(N) | O(N) |
| æŸ¥è¯¢å•ä¸ªèŠ‚ç‚¹ | O(1) | - |
| è·å–æ‰€æœ‰èŠ‚ç‚¹ | O(N) | O(N) |
| è·å–ä½èƒ½é‡èŠ‚ç‚¹ | O(N) | O(K) |
| è·å–è¿‡æœŸèŠ‚ç‚¹ | O(N) | O(K) |
| å†™å…¥å½’æ¡£ï¼ˆæ‰¹é‡ï¼‰ | O(B) | O(B) |

*æ³¨ï¼šN=èŠ‚ç‚¹æ€»æ•°ï¼ŒK=ç»“æœé›†å¤§å°ï¼ŒB=æ‰¹é‡å¤§å°*

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è‡ªåŠ¨é›†æˆ**ï¼šå·²é›†æˆåˆ°ADCRä¸­ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨
2. **æ–‡ä»¶è·¯å¾„**ï¼šå½’æ¡£æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆåœ¨ `data/[session]/virtual_center_node_info.csv`
3. **æ‰¹é‡å†™å…¥**ï¼šæ¯100æ¡è®°å½•è‡ªåŠ¨å†™å…¥ï¼Œå‡å°‘ç£ç›˜I/O
4. **å¼ºåˆ¶åˆ·æ–°**ï¼šä»¿çœŸç»“æŸæ—¶è‡ªåŠ¨å¼ºåˆ¶åˆ·æ–°ï¼Œç¡®ä¿æ‰€æœ‰æ•°æ®æŒä¹…åŒ–
5. **ä¿¡æ¯å¹´é¾„**ï¼š`age = arrival_time - freshness`ï¼Œè¡¨ç¤ºä¿¡æ¯çš„å»¶è¿Ÿ
6. **å†…å­˜æ§åˆ¶**ï¼šL2ç¼“å­˜å›ºå®šå¤§å°ï¼ˆé»˜è®¤1000ï¼‰ï¼Œè‡ªåŠ¨æ·˜æ±°æ—§è®°å½•

---

## ğŸš€ æœªæ¥æ‰©å±•

### å¯èƒ½çš„å¢å¼ºåŠŸèƒ½ï¼š

1. **SQLæ•°æ®åº“æ”¯æŒ**
   ```python
   vc = VirtualCenter(
       archive_backend="sqlite",
       archive_path="vc_info.db"
   )
   ```

2. **å®æ—¶æŸ¥è¯¢ä¼˜åŒ–**
   ```python
   # æ·»åŠ ç´¢å¼•æ”¯æŒ
   vc.create_index('energy')
   low_nodes = vc.query("energy < 500")
   ```

3. **æ•°æ®å‹ç¼©**
   ```python
   # å¯¹å†å²æ•°æ®è¿›è¡Œå‹ç¼©
   vc.enable_compression(algorithm='gzip')
   ```

4. **å¤šè™šæ‹Ÿä¸­å¿ƒåŒæ­¥**
   ```python
   # å¤šä¸ªè™šæ‹Ÿä¸­å¿ƒä¹‹é—´åŒæ­¥ä¿¡æ¯
   vc1.sync_with(vc2)
   ```

---

## âœ… æ€»ç»“

è™šæ‹Ÿä¸­å¿ƒèŠ‚ç‚¹ä¿¡æ¯è¡¨æä¾›äº†ä¸€ä¸ª**é«˜æ•ˆã€çµæ´»ã€å¯æ‰©å±•**çš„èŠ‚ç‚¹çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼š

- âœ… **ä¸‰çº§ç¼“å­˜**ï¼šå¹³è¡¡å†…å­˜å’Œæ€§èƒ½
- âœ… **è‡ªåŠ¨åˆå§‹åŒ–**ï¼šADCRåˆ›å»ºæ—¶ç«‹å³å¡«å……æ‰€æœ‰èŠ‚ç‚¹åˆå§‹å€¼ âœ¨ æ–°å¢
- âœ… **è‡ªåŠ¨æ›´æ–°**ï¼šADCRæ¯24å°æ—¶è‡ªåŠ¨æ›´æ–°æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€
- âœ… **æŒä¹…åŒ–å­˜å‚¨**ï¼šè‡ªåŠ¨ä¿å­˜åˆ°CSVæ–‡ä»¶
- âœ… **ä¸°å¯ŒAPI**ï¼šæ”¯æŒå¤šç§æŸ¥è¯¢æ–¹å¼
- âœ… **æ˜“äºåˆ†æ**ï¼šæ ‡å‡†CSVæ ¼å¼ï¼Œå…¼å®¹pandas

**æ–‡ä»¶è¾“å‡º**ï¼š`data/[session_dir]/virtual_center_node_info.csv`

**æ—¶é—´çº¿ï¼š**
```
t=0      â†’ åˆå§‹åŒ–ï¼šå¡«å……æ‰€æœ‰èŠ‚ç‚¹åˆå§‹å€¼ï¼ˆinitial_energyï¼‰
t=1440   â†’ ç¬¬1æ¬¡ADCRæ›´æ–°ï¼šè®°å½•èƒ½é‡å˜åŒ– + ç°‡åˆ†é…
t=2880   â†’ ç¬¬2æ¬¡ADCRæ›´æ–°ï¼šè®°å½•èƒ½é‡å˜åŒ– + ç°‡åˆ†é…
...      â†’ æŒç»­æ›´æ–°
ç»“æŸæ—¶   â†’ å¼ºåˆ¶åˆ·æ–°ï¼šç¡®ä¿æ‰€æœ‰æ•°æ®æŒä¹…åŒ–
```

