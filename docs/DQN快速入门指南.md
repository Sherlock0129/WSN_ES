# DQNè°ƒåº¦å™¨å¿«é€Ÿå…¥é—¨æŒ‡å—

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šè®­ç»ƒDQNï¼ˆæ¨èï¼‰

```bash
# å®Œæ•´è®­ç»ƒï¼ˆ50å›åˆï¼Œçº¦3å°æ—¶ï¼Œæ¨èï¼‰
python run_dqn_simulation.py --train --episodes 50

# å¿«é€Ÿè®­ç»ƒï¼ˆ20å›åˆï¼Œçº¦1å°æ—¶ï¼Œç”¨äºå¿«é€Ÿæµ‹è¯•ï¼‰
python run_dqn_simulation.py --train --episodes 20

# æœ€å°è®­ç»ƒï¼ˆ10å›åˆï¼Œçº¦30åˆ†é’Ÿï¼ŒéªŒè¯åŠŸèƒ½ï¼‰
python run_dqn_simulation.py --train --episodes 10
```

**è®­ç»ƒæ—¶ä¼šçœ‹åˆ°ï¼š**
```
================================================================================
DQNæ·±åº¦å¼ºåŒ–å­¦ä¹ è°ƒåº¦å™¨è®­ç»ƒ
================================================================================

[1] åˆ›å»ºDQNè°ƒåº¦å™¨...
  [OK] åŠ¨ä½œç©ºé—´: 10ä¸ªç¦»æ•£åŠ¨ä½œï¼ˆ1-10åˆ†é’Ÿï¼‰
  [OK] åˆå§‹æ¢ç´¢ç‡: 1.0
  [OK] å­¦ä¹ ç‡: 0.001

[2] å¼€å§‹è®­ç»ƒï¼ˆ50å›åˆï¼‰...
--------------------------------------------------------------------------------
  å›åˆ 10/50: Loss=0.1234, Îµ=0.6050, Buffer=1000
  å›åˆ 20/50: Loss=0.0856, Îµ=0.3660, Buffer=2000
  å›åˆ 30/50: Loss=0.0567, Îµ=0.2215, Buffer=3000
  å›åˆ 40/50: Loss=0.0345, Îµ=0.1340, Buffer=4000
  å›åˆ 50/50: Loss=0.0234, Îµ=0.0811, Buffer=5000
--------------------------------------------------------------------------------

[3] è®­ç»ƒå®Œæˆï¼

[DQN] æ¨¡å‹å·²ä¿å­˜åˆ°: dqn_model.pth
[SUCCESS] æ¨¡å‹å·²ä¿å­˜åˆ°: dqn_model.pth
```

### ç¬¬äºŒæ­¥ï¼šæµ‹è¯•DQN

```bash
python run_dqn_simulation.py --test
```

**æµ‹è¯•ç»“æœç¤ºä¾‹ï¼š**
```
================================================================================
DQNè°ƒåº¦å™¨æµ‹è¯•
================================================================================

[1] åˆ›å»ºæµ‹è¯•ç½‘ç»œ...
  [OK] ç½‘ç»œèŠ‚ç‚¹æ•°: 16

[2] åˆ›å»ºDQNè°ƒåº¦å™¨ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰...
  [OK] æ¨¡å‹å·²åŠ è½½: dqn_model.pth

[3] è¿è¡Œä»¿çœŸï¼ˆ200æ­¥ï¼‰...
--------------------------------------------------------------------------------
[ä»¿çœŸè¾“å‡º...]
--------------------------------------------------------------------------------

[4] ä»¿çœŸç»Ÿè®¡:

  ä¼ è¾“ç»Ÿè®¡:
  - æ€»ä¼ è¾“æ¬¡æ•°: 156
  - å¹³å‡ä¼ è¾“æ—¶é•¿: 4.23 åˆ†é’Ÿ
  - æ€»ä¼ è¾“èƒ½é‡: 32900J

  åŠ¨ä½œä½¿ç”¨é¢‘ç‡:
     1åˆ†é’Ÿ: â–ˆâ–ˆâ–ˆâ–ˆ 12æ¬¡ ( 7.7%)
     2åˆ†é’Ÿ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 18æ¬¡ (11.5%)
     3åˆ†é’Ÿ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 24æ¬¡ (15.4%)
     4åˆ†é’Ÿ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 30æ¬¡ (19.2%)
     5åˆ†é’Ÿ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 36æ¬¡ (23.1%)
     6åˆ†é’Ÿ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 20æ¬¡ (12.8%)
     7åˆ†é’Ÿ: â–ˆâ–ˆâ–ˆâ–ˆ 10æ¬¡ ( 6.4%)
     8-10åˆ†é’Ÿ: â–ˆâ–ˆ 6æ¬¡ ( 3.9%)

  èƒ½é‡ç»Ÿè®¡:
  - å¹³å‡èƒ½é‡: 28456J
  - èƒ½é‡æ ‡å‡†å·®: 4567J
  - èƒ½é‡CV: 0.1605

[SUCCESS] æµ‹è¯•å®Œæˆï¼
```

### ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œå®Œæ•´ä»¿çœŸï¼ˆå¯é€‰ï¼‰

```bash
# è¿è¡Œ7å¤©ä»¿çœŸï¼ˆ10080åˆ†é’Ÿï¼‰
python run_dqn_simulation.py --full --steps 10080

# è¿è¡Œ1å¤©ä»¿çœŸï¼ˆ1440åˆ†é’Ÿï¼‰
python run_dqn_simulation.py --full --steps 1440
```

## ğŸ“‹ å®Œæ•´ä½¿ç”¨æµç¨‹

### æ–¹æ¡ˆAï¼šä½¿ç”¨run_dqn_simulation.pyï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œé›†æˆäº†è®­ç»ƒã€æµ‹è¯•å’Œè¿è¡Œã€‚

```bash
# 1. è®­ç»ƒ
python run_dqn_simulation.py --train --episodes 50

# 2. æµ‹è¯•
python run_dqn_simulation.py --test

# 3. è¿è¡Œå®Œæ•´ä»¿çœŸ
python run_dqn_simulation.py --full --steps 10080
```

### æ–¹æ¡ˆBï¼šä½¿ç”¨test_dqn_scheduler.py

æ›´è¯¦ç»†çš„è®­ç»ƒå’Œæµ‹è¯•ï¼ŒåŒ…å«å¯è§†åŒ–ã€‚

```bash
# è®­ç»ƒ+æµ‹è¯•ï¼ˆä¼šç”Ÿæˆè®­ç»ƒæ›²çº¿å›¾ï¼‰
python test_dqn_scheduler.py --mode both --episodes 50

# åªè®­ç»ƒ
python test_dqn_scheduler.py --mode train --episodes 50

# åªæµ‹è¯•
python test_dqn_scheduler.py --mode test
```

### æ–¹æ¡ˆCï¼šåœ¨è‡ªå·±çš„ä»£ç ä¸­ä½¿ç”¨

```python
from scheduling.dqn_scheduler import DQNScheduler
from info_collection.physical_center import NodeInfoManager
from core.energy_simulation import EnergySimulation

# 1. åˆ›å»ºèŠ‚ç‚¹ä¿¡æ¯ç®¡ç†å™¨
nim = NodeInfoManager(
    initial_position=(5.0, 5.0),
    enable_logging=False
)
nim.initialize_node_info(network.nodes, initial_time=0)

# 2. åˆ›å»ºDQNè°ƒåº¦å™¨ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰
scheduler = DQNScheduler(
    node_info_manager=nim,
    K=2,
    max_hops=3,
    action_dim=10,
    training_mode=False  # æµ‹è¯•æ¨¡å¼
)

# 3. åˆå§‹åŒ–å¹¶åŠ è½½æ¨¡å‹
scheduler.plan(network, 0)  # è§¦å‘åˆå§‹åŒ–
scheduler.load_model("dqn_model.pth")

# 4. è¿è¡Œä»¿çœŸ
simulation = EnergySimulation(
    network=network,
    time_steps=1000,
    scheduler=scheduler,
    enable_energy_sharing=True
)

simulation.simulate()
```

## âš™ï¸ å‚æ•°è°ƒæ•´

### è®­ç»ƒå‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | è°ƒæ•´å»ºè®® |
|------|--------|------|---------|
| `--episodes` | 50 | è®­ç»ƒå›åˆæ•° | 20-100å›åˆ |
| `--steps` | 100 | æ¯å›åˆæ­¥æ•° | 50-200æ­¥ |
| `lr` | 1e-3 | å­¦ä¹ ç‡ | 5e-4 ~ 5e-3 |
| `epsilon_start` | 1.0 | åˆå§‹æ¢ç´¢ç‡ | å›ºå®š1.0 |
| `epsilon_end` | 0.01 | æœ€ç»ˆæ¢ç´¢ç‡ | 0.01 ~ 0.05 |
| `epsilon_decay` | 0.995 | æ¢ç´¢ç‡è¡°å‡ | 0.99 ~ 0.999 |

### å¿«é€Ÿè®­ç»ƒï¼ˆæµ‹è¯•ç”¨ï¼‰

```python
scheduler = DQNScheduler(
    node_info_manager=nim,
    epsilon_decay=0.99,  # å¿«é€Ÿè¡°å‡
    buffer_capacity=5000  # è¾ƒå°ç¼“å†²åŒº
)
# è®­ç»ƒ10-20å›åˆå³å¯
```

### ç²¾ç»†è®­ç»ƒï¼ˆæœ€ä¼˜æ€§èƒ½ï¼‰

```python
scheduler = DQNScheduler(
    node_info_manager=nim,
    epsilon_decay=0.998,  # æ…¢é€Ÿè¡°å‡
    buffer_capacity=20000,  # å¤§ç¼“å†²åŒº
    lr=5e-4  # è¾ƒå°å­¦ä¹ ç‡
)
# è®­ç»ƒ100å›åˆä»¥ä¸Š
```

## ğŸ“Š è®­ç»ƒç›‘æ§

### è§‚å¯Ÿè®­ç»ƒè¿›åº¦

**Lossï¼ˆæŸå¤±ï¼‰**ï¼š
```
å›åˆ 10: Loss=0.1234  â† åˆæœŸè¾ƒå¤§
å›åˆ 20: Loss=0.0856  â† é€æ¸ä¸‹é™
å›åˆ 30: Loss=0.0567  
å›åˆ 40: Loss=0.0345  â† è¶‹äºç¨³å®š
å›åˆ 50: Loss=0.0234  âœ“ æ”¶æ•›
```

**Epsilonï¼ˆæ¢ç´¢ç‡ï¼‰**ï¼š
```
å›åˆ 10: Îµ=0.6050  â† é«˜æ¢ç´¢
å›åˆ 20: Îµ=0.3660  
å›åˆ 30: Îµ=0.2215  
å›åˆ 40: Îµ=0.1340  â† é€æ¸å‡å°‘
å›åˆ 50: Îµ=0.0811  â† ä½æ¢ç´¢ï¼Œä¸»è¦åˆ©ç”¨
```

**Bufferï¼ˆç»éªŒç¼“å†²åŒºï¼‰**ï¼š
```
å›åˆ 10: Buffer=1000  â† é€æ¸å¡«å……
å›åˆ 20: Buffer=2000  
å›åˆ 30: Buffer=3000  
...
Bufferæ»¡ï¼ˆ10000ï¼‰åå¼€å§‹è¦†ç›–æ—§ç»éªŒ
```

### åˆ¤æ–­è®­ç»ƒè´¨é‡

**å¥½çš„è®­ç»ƒ**ï¼š
- âœ… Lossä»0.1+ä¸‹é™åˆ°0.05ä»¥ä¸‹
- âœ… Epsilonä»1.0è¡°å‡åˆ°0.1ä»¥ä¸‹
- âœ… Bufferé€æ¸å¢é•¿åˆ°æ•°åƒ
- âœ… åæœŸLossè¶‹äºç¨³å®š

**éœ€è¦ç»§ç»­è®­ç»ƒ**ï¼š
- âš ï¸ Lossä»åœ¨0.1ä»¥ä¸Š
- âš ï¸ Losså‰§çƒˆéœ‡è¡
- âš ï¸ Epsilonè¿˜å¾ˆé«˜ï¼ˆ>0.3ï¼‰

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šè®­ç»ƒLossä¸ä¸‹é™

**åŸå› **: å­¦ä¹ ç‡è¿‡å¤§æˆ–è¿‡å°

**è§£å†³**:
```python
scheduler = DQNScheduler(
    lr=5e-4,  # é™ä½å­¦ä¹ ç‡
    ...
)
```

### é—®é¢˜2ï¼šè®­ç»ƒä¸ç¨³å®šï¼ŒLosséœ‡è¡

**åŸå› **: æ¢ç´¢ç‡è¡°å‡è¿‡å¿«æˆ–ç½‘ç»œæ›´æ–°è¿‡äºé¢‘ç¹

**è§£å†³**:
```python
scheduler = DQNScheduler(
    epsilon_decay=0.998,  # æ…¢é€Ÿè¡°å‡
    tau=0.001,  # æ›´å°çš„è½¯æ›´æ–°ç³»æ•°
    ...
)
```

### é—®é¢˜3ï¼šæ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯**:
```
[ERROR] æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨: dqn_model.pth
è¯·å…ˆè¿è¡Œè®­ç»ƒï¼špython run_dqn_simulation.py --train
```

**è§£å†³**: å…ˆè®­ç»ƒæ¨¡å‹
```bash
python run_dqn_simulation.py --train --episodes 20
```

### é—®é¢˜4ï¼šå†…å­˜ä¸è¶³

**è§£å†³**: å‡å°ç½‘ç»œè§„æ¨¡å’Œç¼“å†²åŒº
```python
config.network_config.num_nodes = 10  # å‡å°‘èŠ‚ç‚¹æ•°
scheduler = DQNScheduler(
    buffer_capacity=5000,  # å‡å°ç¼“å†²åŒº
    ...
)
```

### é—®é¢˜5ï¼šè®­ç»ƒå¤ªæ…¢

**è§£å†³**: 
1. å‡å°‘å›åˆæ•°å’Œæ­¥æ•°
```bash
python run_dqn_simulation.py --train --episodes 20
```

2. ä½¿ç”¨GPUï¼ˆå¦‚æœæœ‰ï¼‰
```python
# PyTorchä¼šè‡ªåŠ¨ä½¿ç”¨GPU
# æ£€æŸ¥ï¼štorch.cuda.is_available()
```

3. å‡å°ç½‘ç»œè§„æ¨¡
```python
config.network_config.num_nodes = 10
config.simulation_config.time_steps = 50
```

## ğŸ“ˆ æ€§èƒ½æå‡å»ºè®®

### è®­ç»ƒç­–ç•¥

**é˜¶æ®µ1ï¼šå¿«é€Ÿæ¢ç´¢ï¼ˆå‰20å›åˆï¼‰**
```python
epsilon_decay = 0.99  # å¿«é€Ÿè¡°å‡
episodes = 20
```

**é˜¶æ®µ2ï¼šç²¾ç»†ä¼˜åŒ–ï¼ˆå30å›åˆï¼‰**
```python
epsilon_decay = 0.998  # æ…¢é€Ÿè¡°å‡
lr = 5e-4  # é™ä½å­¦ä¹ ç‡
episodes = 30
```

### è¶…å‚æ•°ç½‘æ ¼æœç´¢

```bash
# æµ‹è¯•ä¸åŒå­¦ä¹ ç‡
for lr in 5e-4 1e-3 5e-3; do
    python run_dqn_simulation.py --train --episodes 30
done

# æµ‹è¯•ä¸åŒæ¢ç´¢ç‡è¡°å‡
for decay in 0.99 0.995 0.998; do
    python run_dqn_simulation.py --train --episodes 30
done
```

## ğŸ“ æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `run_dqn_simulation.py` | **å¿«é€Ÿå¯åŠ¨è„šæœ¬**ï¼ˆæ¨èï¼‰ |
| `test_dqn_scheduler.py` | è¯¦ç»†è®­ç»ƒæµ‹è¯•è„šæœ¬ï¼ˆå«å¯è§†åŒ–ï¼‰ |
| `dqn_model.pth` | è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶ |
| `dqn_training_curves.png` | è®­ç»ƒæ›²çº¿å›¾ï¼ˆç”±test_dqnç”Ÿæˆï¼‰ |
| `src/scheduling/dqn_scheduler.py` | DQNè°ƒåº¦å™¨å®ç° |
| `DQNç¦»æ•£åŠ¨ä½œè°ƒåº¦å™¨è¯´æ˜.md` | è¯¦ç»†æŠ€æœ¯æ–‡æ¡£ |

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. è®­ç»ƒæµç¨‹

```bash
# Step 1: å¿«é€ŸéªŒè¯ï¼ˆ30åˆ†é’Ÿï¼‰
python run_dqn_simulation.py --train --episodes 10

# Step 2: æµ‹è¯•æ•ˆæœ
python run_dqn_simulation.py --test

# Step 3: å¦‚æœæ•ˆæœå¥½ï¼Œå®Œæ•´è®­ç»ƒï¼ˆ3å°æ—¶ï¼‰
python run_dqn_simulation.py --train --episodes 50

# Step 4: è¿è¡Œé•¿æœŸä»¿çœŸ
python run_dqn_simulation.py --full --steps 10080
```

### 2. æ¨¡å‹ç‰ˆæœ¬ç®¡ç†

```bash
# ä¿å­˜ä¸åŒç‰ˆæœ¬
python run_dqn_simulation.py --train --episodes 20 --model dqn_v1.pth
python run_dqn_simulation.py --train --episodes 50 --model dqn_v2.pth
python run_dqn_simulation.py --train --episodes 100 --model dqn_v3.pth

# æµ‹è¯•ä¸åŒç‰ˆæœ¬
python run_dqn_simulation.py --test --model dqn_v1.pth
python run_dqn_simulation.py --test --model dqn_v2.pth
```

### 3. å¯¹æ¯”æµ‹è¯•

```python
# æµ‹è¯•DQN vs Lyapunov
from scheduling.schedulers import LyapunovScheduler

# è¿è¡Œä¸¤æ¬¡ä»¿çœŸï¼Œå¯¹æ¯”ç»“æœ
# 1. DQN
# 2. Lyapunov
```

## ğŸ¯ æ¨èé…ç½®

### å¿«é€Ÿæµ‹è¯•é…ç½®

```bash
python run_dqn_simulation.py --train --episodes 10
```
- æ—¶é—´ï¼š~30åˆ†é’Ÿ
- ç”¨é€”ï¼šéªŒè¯åŠŸèƒ½
- æ€§èƒ½ï¼šä¸­ç­‰

### æ ‡å‡†é…ç½®ï¼ˆæ¨èï¼‰â­

```bash
python run_dqn_simulation.py --train --episodes 50
```
- æ—¶é—´ï¼š~3å°æ—¶
- ç”¨é€”ï¼šå®é™…ä½¿ç”¨
- æ€§èƒ½ï¼šä¼˜ç§€

### é«˜æ€§èƒ½é…ç½®

```bash
python run_dqn_simulation.py --train --episodes 100
```
- æ—¶é—´ï¼š~6å°æ—¶
- ç”¨é€”ï¼šè¿½æ±‚æœ€ä¼˜
- æ€§èƒ½ï¼šæœ€ä½³

## ğŸ“ è·å–å¸®åŠ©

```bash
# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
python run_dqn_simulation.py --help

# æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£
# é˜…è¯»ï¼šDQNç¦»æ•£åŠ¨ä½œè°ƒåº¦å™¨è¯´æ˜.md
```

## âœ… æ£€æŸ¥æ¸…å•

è®­ç»ƒå‰ï¼š
- [ ] å·²å®‰è£…PyTorch
- [ ] å·²å®‰è£…NumPyã€Matplotlib
- [ ] ç¡®è®¤æœ‰è¶³å¤Ÿç£ç›˜ç©ºé—´ï¼ˆ~500MBï¼‰

è®­ç»ƒä¸­ï¼š
- [ ] è§‚å¯ŸLossæ˜¯å¦ä¸‹é™
- [ ] è§‚å¯ŸEpsilonæ˜¯å¦è¡°å‡
- [ ] ç¡®è®¤Bufferåœ¨å¢é•¿

è®­ç»ƒåï¼š
- [ ] ç”Ÿæˆäº†dqn_model.pthæ–‡ä»¶
- [ ] è¿è¡Œæµ‹è¯•éªŒè¯æ€§èƒ½
- [ ] æŸ¥çœ‹åŠ¨ä½œåˆ†å¸ƒæ˜¯å¦åˆç†

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥é˜…ï¼š
- `DQNç¦»æ•£åŠ¨ä½œè°ƒåº¦å™¨è¯´æ˜.md` - è¯¦ç»†æŠ€æœ¯æ–‡æ¡£
- `æ·±åº¦å­¦ä¹ è°ƒåº¦å™¨å¯¹æ¯”.md` - æ–¹æ³•å¯¹æ¯”

