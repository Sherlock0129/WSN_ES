# 智能被动传能系统 - 快速启动指南

## 🚀 立即开始

### 最简单的方式（默认配置）

```bash
# 直接运行，使用默认的智能被动传能配置
python src/sim/refactored_main.py
```

系统将自动使用智能被动传能模式运行，无需任何配置！

---

## 📖 常用命令

### 1️⃣ 查看帮助信息
```bash
python src/sim/refactored_main.py help
```

### 2️⃣ 使用智能被动传能示例配置
```bash
python src/sim/refactored_main.py passive
```

### 3️⃣ 比较传能模式性能
```bash
# 比较智能被动传能 vs 传统主动传能
python src/sim/refactored_main.py compare-passive
```

这将测试4种配置：
- ✅ 智能被动传能(默认)
- ✅ 智能被动传能(快速响应)
- ✅ 智能被动传能(节能型)
- ✅ 传统主动传能(60分钟定时)

### 4️⃣ 比较调度器性能
```bash
python src/sim/refactored_main.py compare
```

### 5️⃣ 使用自定义配置文件
```bash
python src/sim/refactored_main.py config 你的配置文件.json
```

---

## ⚙️ 智能被动传能配置说明

### 运行时你会看到：

```
==================================================
智能被动传能模式已启用
  - 检查间隔: 10 分钟
  - 临界比例: 20.0%
  - 能量方差阈值: 0.30
  - 冷却期: 30 分钟
  - 预测窗口: 60 分钟
==================================================
```

### 触发信息示例：

```
[智能被动传能] 时间步 120: 低能量节点比例=25.00%>20.00%
K=3 pre_std=2345.67 post_std=1234.56 delivered=5000.00 loss=120.00

[智能被动传能] 时间步 350: 能量变异系数=0.352>0.300 | 预测60分钟后将出现能量危机
K=4 pre_std=3456.78 post_std=2345.67 delivered=6000.00 loss=150.00

[智能被动传能] 时间步 580: 存在3个极低能量节点（<阈值50%）
K=5 pre_std=4567.89 post_std=3456.78 delivered=7000.00 loss=180.00
```

---

## 🔧 自定义配置

### 通过Python代码自定义

创建 `my_simulation.py`:

```python
import sys
sys.path.insert(0, 'src')

from config.simulation_config import ConfigManager
from sim.refactored_main import create_scheduler

# 创建配置管理器
config_manager = ConfigManager()

# 自定义智能被动传能参数
config_manager.simulation_config.passive_mode = True
config_manager.simulation_config.check_interval = 10      # 检查间隔
config_manager.simulation_config.critical_ratio = 0.2     # 触发阈值
config_manager.simulation_config.energy_variance_threshold = 0.3
config_manager.simulation_config.cooldown_period = 30     # 冷却期
config_manager.simulation_config.predictive_window = 60   # 预测窗口

# 启用能量传输
config_manager.simulation_config.enable_energy_sharing = True
config_manager.simulation_config.time_steps = 10080  # 7天

# 创建网络和仿真
network = config_manager.create_network()
scheduler = create_scheduler(config_manager)
simulation = config_manager.create_energy_simulation(network, scheduler)

# 运行仿真
simulation.simulate()

# 输出统计
stats = simulation.print_statistics()
print(f"\n传能次数: {len(simulation.plans_by_time)}")
```

运行：
```bash
python my_simulation.py
```

### 通过JSON配置文件自定义

创建 `my_config.json`:

```json
{
  "simulation": {
    "passive_mode": true,
    "check_interval": 10,
    "critical_ratio": 0.2,
    "energy_variance_threshold": 0.3,
    "cooldown_period": 30,
    "predictive_window": 60,
    "enable_energy_sharing": true,
    "time_steps": 10080
  }
}
```

运行：
```bash
python src/sim/refactored_main.py config my_config.json
```

---

## 🎯 三种预设配置

### 1. 快速响应型（关键应用）
```python
config_manager.simulation_config.check_interval = 5       # 频繁检查
config_manager.simulation_config.critical_ratio = 0.15    # 低阈值
config_manager.simulation_config.cooldown_period = 15     # 短冷却期
config_manager.simulation_config.predictive_window = 30
```

**适用场景**：能量敏感型应用，需要快速响应

### 2. 均衡型（推荐，默认）
```python
config_manager.simulation_config.check_interval = 10
config_manager.simulation_config.critical_ratio = 0.2
config_manager.simulation_config.cooldown_period = 30
config_manager.simulation_config.predictive_window = 60
```

**适用场景**：大多数应用场景，平衡性能和开销

### 3. 节能型（能量充足）
```python
config_manager.simulation_config.check_interval = 20      # 少检查
config_manager.simulation_config.critical_ratio = 0.3     # 高阈值
config_manager.simulation_config.cooldown_period = 60     # 长冷却期
config_manager.simulation_config.predictive_window = 90
```

**适用场景**：能量充足，追求最大化节能

---

## 🔄 回退到传统模式

如果需要回到60分钟定时触发模式：

```python
config_manager.simulation_config.passive_mode = False
```

或在JSON配置文件中：
```json
{
  "simulation": {
    "passive_mode": false
  }
}
```

---

## 📊 查看结果

### 仿真完成后输出：

1. **控制台输出**
   - 传能触发信息
   - K值变化
   - 能量统计

2. **结果文件** (保存在 `data/YYYYMMDD_HHMMSS/`)
   - `simulation_results.csv` - 详细结果数据
   - `energy_over_time.png` - 能量变化图
   - `node_distribution.png` - 节点分布图
   - `K_value_history.png` - K值变化图
   - `config.json` - 使用的配置参数

### 关键统计指标：

```
统计信息:
  传能次数: 142 次            # 智能被动传能的触发次数
  平均方差: 1234.56           # 能量分布均衡度
  总能量损失: 5678.90 J       # 传输过程损耗
  能量效率: 85.23%            # 传输效率
```

---

## 🧪 性能测试

### 快速测试（1天）

```python
config_manager.simulation_config.time_steps = 1440  # 1天 = 1440分钟
```

### 标准测试（7天）

```python
config_manager.simulation_config.time_steps = 10080  # 7天 = 10080分钟
```

### 长期测试（30天）

```python
config_manager.simulation_config.time_steps = 43200  # 30天
```

---

## ❓ 常见问题

### Q1: 如何知道系统使用的是哪种模式？

**A**: 运行时查看日志输出：
```
智能被动传能模式已启用    ← 智能被动模式
```
或
```
传统主动传能模式 (每60分钟定时触发)    ← 传统模式
```

### Q2: 触发太频繁怎么办？

**A**: 增大冷却期或提高阈值：
```python
config_manager.simulation_config.cooldown_period = 60    # 增大到60分钟
config_manager.simulation_config.critical_ratio = 0.3    # 提高到30%
```

### Q3: 响应太慢怎么办？

**A**: 减小检查间隔或降低阈值：
```python
config_manager.simulation_config.check_interval = 5      # 减小到5分钟
config_manager.simulation_config.critical_ratio = 0.15   # 降低到15%
```

### Q4: 如何完全禁用能量传输？

**A**: 
```python
config_manager.simulation_config.enable_energy_sharing = False
```

### Q5: 能量分布不均怎么办？

**A**: 降低能量方差阈值：
```python
config_manager.simulation_config.energy_variance_threshold = 0.25
```

---

## 📚 更多资源

- 📖 **详细文档**: `docs/智能被动传能系统说明.md`
- 📄 **配置示例**: `src/config/智能被动传能示例.json`
- 📝 **升级说明**: `智能被动传能升级说明.md`
- 🧪 **测试脚本**: `test_intelligent_passive.py`

---

## 💡 最佳实践

1. **首次使用**: 使用默认配置运行，观察效果
   ```bash
   python src/sim/refactored_main.py
   ```

2. **性能对比**: 比较不同模式的表现
   ```bash
   python src/sim/refactored_main.py compare-passive
   ```

3. **参数调优**: 根据实际情况逐步调整参数

4. **保存配置**: 将调优后的配置保存为JSON文件

5. **定期测试**: 使用不同网络规模和能量消耗模式测试

---

## 🎉 开始使用

现在就试试吧！

```bash
# 最简单的开始方式
python src/sim/refactored_main.py

# 或者先看看帮助
python src/sim/refactored_main.py help
```

**祝您使用愉快！** 🚀

