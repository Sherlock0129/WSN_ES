# 第五章实验设计与图表需求总结

## 一、实验设计概览

### 实验配置
- **网络规模**：N=30（单一规模）
- **拓扑类型**：能量空洞
- **部署区域**：50×50 m²
- **初始能量**：40000-43000 J
- **仿真时长**：10080分钟（7天）
- **重复次数**：10次独立随机种子（{42, 123, 256, 512, 1024, 2048, 4096, 8192, 16384, 32768}）
- **统计方法**：Bootstrap 95% CI（1000次重采样），Wilcoxon秩和检验（双侧）

### 1. 四类主实验（E1-E4）

#### **E1：智能被动触发 vs 固定周期触发**
- **目标**：验证价格信号驱动的按需触发是否优于固定周期触发
- **对比**：
  - 提案机制：价格信号触发（低能比例>0.2 或 CV>0.3）
  - 基线：固定60分钟周期触发
- **关键指标**：
  - 首死时间（寿命）：中位相对提升约18.3%（IQR≈6.1%）
  - 触发频率：减少60%-70%
  - 累计发送能量：减少55%-65%
  - 稳定性：重配率下降约60%

#### **E2：信息价值剖析**
- **目标**：检验信息透明层（InfoNode缓存+价值加权）的作用
- **对比**：
  - 提案机制：InfoNode + 信息价值奖励
  - 基线1：去除信息奖励（保留缓存）
  - 基线2：去除缓存（周期上报）
- **关键指标**：
  - 路径收集/上报次数：去除信息奖励后暴增4-5倍
  - 信息通信能耗：从≈0.7 kJ/节点升至>3 kJ/节点
  - AOEI均值与分布
  - 传输效率：下降1-2个百分点
  - 反馈评分：显著降低

#### **E3：上报制度对比**
- **目标**：比较不同信息上报策略的制度权衡
- **对比**：
  - 提案机制：机会主义上报（路径搭载+去重）
  - 基线1：ADCR点对点上报
  - 基线2：周期直发上报
- **关键指标**：
  - 信息通信能耗
  - 上报频次
  - 反馈评分
  - 弱势节点服务覆盖率

#### **E4：自适应时长调度 vs 传统Lyapunov**
- **目标**：验证路径治理+自适应时长的协同效应
- **对比**：
  - 提案机制：AdaptiveDurationAware + EETOR路径约束
  - 基线：传统Lyapunov（固定τ）
- **关键指标**：
  - 单位能量收益
  - 低效多跳占比（受η_th、H_max约束）
  - 路径效率分布
  - 反馈评分演化
  - 传能次数与信息能耗

### 2. 消融实验（Ablation）
- Ablation-1：去除AOEI价格信号（M1）
- Ablation-2：去除InfoNode缓存（M2）
- Ablation-3：禁用去重/动态等待（M2细则）
- Ablation-4：去除EETOR硬约束（M3）
- Ablation-5：固定K值（M4）
- Ablation-6：去除公平保护（M1/M3的公平项）

### 3. 帕累托分析
在三组二维目标对上绘制帕累托前沿：
- **效率-公平**（η_E, CV）
- **寿命-效率**（T_death, η_E）
- **信息新鲜度-通信开销**（AOEI, E_com）

---

## 二、需要绘制的图表清单

### **E1相关图表（2张）**

#### 1. `e1_energy_over_time_proposed.png` + `e1_energy_over_time_period60.png`
- **类型**：节点能量时序图（并排对比，两个minipage）
- **内容**：
  - 左图：提案机制（价格触发）的能量轨迹
  - 右图：固定60分钟触发的能量轨迹
- **绘制方法**：
  - 横轴：时间（分钟，0-10080）
  - 纵轴：节点能量（J）
  - 多条曲线：每个节点一条，用不同颜色/透明度区分（N=30条线）
  - 标注：低阈值线（θ_low=0.30）、高阈值线（θ_high=0.80）
  - 突出：节点死亡时间点（能量降至0）
  - 配置：能量空洞拓扑，N=30
- **数据来源**：`center_node_energy_over_time.png` 或对应CSV

#### 2. `e1_triggers_energy_costs.png`
- **类型**：柱状图/箱线图（带误差棒）
- **内容**：
  - 触发次数对比（提案 vs 固定60min）
  - 累计发送能量对比
  - 显示均值±95% CI（10次重复）
- **绘制方法**：
  - 分组柱状图：两种方法并排
  - 误差棒：Bootstrap 95%置信区间（1000次重采样）
  - 双Y轴：左轴触发次数，右轴能量（kJ）
  - 标注：相对减少百分比（约60%-70%触发次数减少，55%-65%能量减少）

### **E2相关图表（2张）**

#### 3. `e2_aoei_hist.png`
- **类型**：直方图/密度图（多组对比）
- **内容**：
  - 提案机制（InfoNode+价值奖励）的AOEI分布
  - 去除信息奖励的AOEI分布
  - 去除缓存的AOEI分布（可选）
- **绘制方法**：
  - 重叠直方图或密度曲线
  - 横轴：AOEI（分钟，越左越新鲜）
  - 纵轴：频数/密度
  - 不同颜色区分三种配置
  - 标注：均值、中位数线

#### 4. `e2_energy_over_time_no_info_reward.png`
- **类型**：节点能量时序图
- **内容**：去除信息奖励后的能量演化
- **绘制方法**：同E1的能量时序图，突出波动放大与同步失效风险

### **E3相关图表（2张）**

#### 5. `e3_comm_costs_reports.png`
- **类型**：分组柱状图
- **内容**：
  - 三种上报策略的信息通信能耗对比
  - 上报频次对比
- **绘制方法**：
  - 分组柱状图：机会主义、ADCR、周期直发
  - 双Y轴：左轴能耗（kJ），右轴频次
  - 误差棒：95% CI

#### 6. `e3_feedback_fairness.png`
- **类型**：分组柱状图/雷达图
- **内容**：
  - 反馈评分对比
  - 弱势节点服务覆盖率对比
- **绘制方法**：
  - 分组柱状图：三种策略并排
  - 或雷达图：多维度对比（反馈、公平性、效率等）

### **E4相关图表（3张）**

#### 7. `e4_feedback_scores_adaptive.png`
- **类型**：时序图/密度图
- **内容**：自适应时长+价格机制下的反馈分布演化
- **绘制方法**：
  - 时序图：横轴时间，纵轴反馈评分，多条曲线表示不同维度
  - 或密度图：反馈评分的分布演化（热力图）
  - 参考：`feedback_scores_adaptive_durationaware.png` 的格式

#### 8. `e4_path_eff_hist.png`
- **类型**：直方图（对比）
- **内容**：路径效率分布（提案 vs 传统Lyapunov）
- **绘制方法**：
  - 重叠直方图
  - 横轴：路径效率（0-1）
  - 纵轴：频数
  - 标注：效率阈值线（η_th=0.05）

#### 9. `e4_low_eff_ratio.png`
- **类型**：柱状图
- **内容**：低效多跳占比对比
- **绘制方法**：
  - 柱状图：提案 vs 传统Lyapunov
  - 误差棒：95% CI
  - 标注：目标线（<10%）

### **帕累托分析图表（3张）**

#### 10. `pareto_efficiency_fairness.png`
- **类型**：散点图+凸包前沿
- **内容**：效率-公平帕累托前沿（η_E vs CV）
- **绘制方法**：
  - 散点图：每个点代表一次实验运行（10次重复 × 不同方法）
  - 不同颜色/形状：不同方法（提案、基线1、基线2等）
  - 绘制凸包前沿（Pareto front）
  - 标注：超体积指标（HV）及被支配率
  - 横轴：效率（η_E），纵轴：CV（越小越好，可能需要反转或使用1-CV）
  - 统计：配对Wilcoxon检验，Bootstrap 95% CI

#### 11. `pareto_lifetime_efficiency.png`
- **类型**：散点图+凸包前沿
- **内容**：寿命-效率帕累托前沿（T_death vs η_E）
- **绘制方法**：同10，横轴：首死时间，纵轴：效率

#### 12. `pareto_aoei_comm_cost.png`
- **类型**：散点图+凸包前沿
- **内容**：信息新鲜度-通信开销帕累托前沿（AOEI vs E_com）
- **绘制方法**：同10，横轴：AOEI均值，纵轴：通信开销

---

## 三、数据来源与绘制工具

### 数据文件位置
- 仿真结果目录：`data/YYYYMMDD_HHMMSS_实验标识/`
- 关键文件：
  - `simulation_statistics.txt` / `simulation_statistics.json`：汇总统计
  - `center_node_energy_over_time.png`：已有能量时序图（可复用）
  - `feedback_scores_*.png`：反馈评分图（可复用）
  - CSV文件：`energy_over_time.csv`, `transfer_history.csv` 等

### 绘制工具建议
- **Matplotlib**：用于静态图表（时序图、柱状图、直方图）
- **Plotly**：用于交互式图表（可选）
- **Seaborn**：用于统计图表（箱线图、密度图）

### 绘制脚本位置
- 现有脚本：`src/viz/plotter.py`, `src/viz/duration_aware_plotter.py`
- 建议：在 `src/experiments/visualize_results.py` 中扩展或新建 `src/experiments/plot_experiment_results.py`

---

## 四、表格需求

文档中提供了注释掉的三线表模板（E1-E4），需要填充以下数据：

### E1表格：触发策略的整体表现
- 存活节点数
- 总发送能量（kJ）
- 总接收能量（kJ）
- 损耗能量（kJ）
- 传输效率（%）
- 能量方差
- 传能次数
- 信息能耗（kJ）

### E2表格：信息层组件对能效与通信代价的影响
- 传输效率（%）
- 能量方差
- 信息总耗（kJ）
- 信息/节点（kJ）
- 收集次数
- 反馈均值

### E3表格：上报制度的通信与体验权衡
- 传输效率（%）
- 能量方差
- 信息总耗（kJ）
- 上报次数
- 低效多跳（%）
- 反馈均值

### E4表格：调度策略对比
- 存活节点数（结尾）
- 总发送能量（kJ）
- 总接收能量（kJ）
- 损耗能量（kJ）
- 传输效率（%）
- 能量方差
- 传能次数
- 信息能耗（kJ）

**数据提取**：从各实验目录的 `simulation_statistics.json` 中提取，建议编写自动化脚本汇总。

---

## 五、绘制优先级

### 高优先级（核心结果展示）
1. E1能量时序对比图（图1）
2. E1触发次数/能量支出对比（图2）
3. E2 AOEI分布对比（图3）
4. E4反馈评分演化（图7）
5. 帕累托前沿图（图10-12）

### 中优先级（机制验证）
6. E2无信息奖励能量轨迹（图4）
7. E3通信能耗对比（图5）
8. E4路径效率分布（图8）

### 低优先级（补充说明）
9. E3反馈/公平性对比（图6）
10. E4低效多跳占比（图9）

---

## 六、注意事项

1. **统计显著性**：所有对比图需标注统计检验结果（p值、效应量）
   - 使用配对Wilcoxon秩和检验（双侧，α=0.05）
   - 报告效应量（Cohen's d）以评估实际意义

2. **置信区间**：使用Bootstrap方法计算95% CI（1000次重采样）

3. **实验配置**：
   - **单一配置**：N=30，能量空洞拓扑，50×50 m²
   - 10次独立随机种子重复
   - 注意：文本中提到"12组配置"，但配置表显示单一配置，可能需要确认是否有其他配置的实验数据

4. **图例与标注**：
   - 清晰标注方法名称、关键参数、统计信息
   - 标注相对改进百分比（如"减少60%-70%"）

5. **字体大小**：根据之前的要求，文字和数字需放大2倍，图例放大2倍

6. **数据文件位置**：
   - 实验数据目录：`data/YYYYMMDD_HHMMSS_实验标识/`
   - 关键文件：`simulation_statistics.txt/json`、`center_node_energy_over_time.png`、CSV文件等

7. **表格数据**：
   - 文档末尾有注释掉的三线表模板（E1-E4）
   - 表格数据可从`simulation_statistics.json`中提取
   - 建议使用自动化脚本汇总数据

