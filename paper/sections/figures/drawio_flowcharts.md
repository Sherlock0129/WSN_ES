# Draw.io 流程图制作说明

本文档说明如何使用 Draw.io 制作机制设计章节的流程图。

## 工具准备

1. 访问 Draw.io: https://app.diagrams.net/ 或下载桌面版
2. 建议使用中文界面（可在设置中切换）

## 流程图1: InfoNode理论能量计算流程图

### 文件信息
- **文件名**: `infonode_energy_estimation.drawio` (Draw.io源文件)
- **导出文件名**: `infonode_energy_estimation.png`
- **位置**: M2节，第221-227行

### 流程图结构

```
开始
  ↓
[输入参数]
  - 上次已知能量 E_i(t_0)
  - 时间间隔 Δt = t - t_0
  - 已知传输计划
  ↓
[步骤1: 计算基础能量变化]
  - 能量消耗: E_cons = E_sen·Δt + E_com·Δt
  - 能量采集: E_harvest = η_solar·A_i·G(t)·Δt
  ↓
[步骤2: 计算传输相关能量]
  - 根据传输计划计算 E_send,i
  - 根据传输计划计算 E_recv,i
  ↓
[步骤3: 计算估算能量]
  E_i^est(t) = E_i(t_0) - E_cons + E_harvest - E_send,i + E_recv,i
  ↓
[步骤4: 边界约束]
  E_i^est(t) = min{C_i, max{0, E_i^est(t)}}
  ↓
[更新InfoNode]
  - E_i(t) ← E_i^est(t)
  - is_estimated_i ← True
  - t_est,i ← t
  ↓
结束
```

### 制作步骤

1. **创建新图表**
   - 文件 → 新建 → 空白图表
   - 设置画布大小：宽800px，高600px

2. **添加形状**
   - **开始/结束**：使用"椭圆"形状（Terminator）
   - **处理步骤**：使用"矩形"形状（Process）
   - **判断**：使用"菱形"形状（Decision）
   - **输入/输出**：使用"平行四边形"形状（Data）

3. **添加文本**
   - 双击形状添加文本
   - 使用数学公式时，可以用LaTeX格式（Draw.io支持部分LaTeX）

4. **连接形状**
   - 使用"连接器"工具连接形状
   - 箭头方向：从上到下
   - 使用"直线"或"折线"连接器

5. **样式设置**
   - **开始/结束**：浅绿色填充
   - **处理步骤**：浅蓝色填充
   - **输入/输出**：浅黄色填充
   - **边框**：黑色，2px宽度
   - **文字**：12pt，加粗

6. **导出图片**
   - 文件 → 导出为 → PNG
   - 分辨率：300 DPI
   - 背景：白色
   - 保存到：`paper_p/sections/figures/infonode_energy_estimation.png`

### 详细布局建议

```
┌─────────────────────────────────────────┐
│           开始 (椭圆)                    │
└─────────────────┬───────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│      输入参数 (平行四边形)                │
│  • E_i(t_0)                             │
│  • Δt = t - t_0                         │
│  • 传输计划                              │
└─────────────────┬───────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│   步骤1: 计算基础能量变化 (矩形)          │
│  E_cons = E_sen·Δt + E_com·Δt          │
│  E_harvest = η_solar·A_i·G(t)·Δt       │
└─────────────────┬───────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│   步骤2: 计算传输相关能量 (矩形)          │
│  根据传输计划计算 E_send,i 和 E_recv,i   │
└─────────────────┬───────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│   步骤3: 计算估算能量 (矩形)              │
│  E_i^est(t) = E_i(t_0) - E_cons        │
│           + E_harvest                   │
│           - E_send,i + E_recv,i         │
└─────────────────┬───────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│   步骤4: 边界约束 (矩形)                 │
│  E_i^est(t) = min{C_i, max{0, ...}}    │
└─────────────────┬───────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│   更新InfoNode (矩形)                    │
│  • E_i(t) ← E_i^est(t)                  │
│  • is_estimated_i ← True                │
│  • t_est,i ← t                          │
└─────────────────┬───────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│           结束 (椭圆)                    │
└─────────────────────────────────────────┘
```

## 流程图2: EETOR路径选择与信息收集示意图

### 文件信息
- **文件名**: `eetor_path_selection.drawio` (Draw.io源文件)
- **导出文件名**: `eetor_path_selection.png`
- **位置**: M4节，第485-491行

### 网络拓扑图结构

这是一个网络拓扑图，需要展示：
1. 网络节点（源节点、中继节点、目标节点、其他节点）
2. 能量传输路径（粗红线）
3. 信息收集路径（蓝色虚线箭头）
4. 节点信息标注（信息量和信息年龄）

### 制作步骤

1. **创建新图表**
   - 文件 → 新建 → 空白图表
   - 设置画布大小：宽1000px，高600px

2. **添加节点**
   - 使用"椭圆"形状表示节点
   - 节点布局：
     ```
     Source    Relay1    Relay2    Target
     (0,1)     (1,1)      (2,1)      (3,1)
     
     Node1     Node2      Node3
     (1,0)     (2,0)      (3,0)
     ```
   - 节点大小：60x60px
   - 节点颜色：
     - Source/Target: 绿色
     - Relay: 橙色
     - Node: 浅蓝色

3. **添加标签**
   - 每个节点添加文本标签
   - Source, Relay1, Relay2, Target, Node1, Node2, Node3

4. **添加能量传输路径**
   - 连接：Source → Relay1 → Relay2 → Target
   - 样式：红色，线宽4px，实线
   - 添加箭头指向

5. **添加信息收集路径**
   - 连接：
     - Relay1 → Node1
     - Relay2 → Node2
     - Target → Node3
   - 样式：蓝色，线宽2px，虚线，带箭头

6. **添加信息标注**
   - 在每个节点旁边添加文本框
   - 标注格式：
     ```
     Relay1: B_v1=50, A_v1=10
     Relay2: B_v2=30, A_v2=15
     Node1:  B_n1=20, A_n1=25
     Node2:  B_n2=15, A_n2=30
     Node3:  B_n3=10, A_n3=35
     ```
   - 文本框样式：浅黄色背景，圆角矩形

7. **添加图例**
   - 在右下角添加图例框
   - 包含：
     - 红色实线：能量传输路径
     - 蓝色虚线：信息收集路径
     - 灰色虚线：通信链路（可选）

8. **添加标题**
   - 在顶部添加标题："EETOR路径选择与信息收集示意图"
   - 字体：14pt，加粗

9. **导出图片**
   - 文件 → 导出为 → PNG
   - 分辨率：300 DPI
   - 背景：白色
   - 保存到：`paper_p/sections/figures/eetor_path_selection.png`

### 详细布局建议

```
        EETOR路径选择与信息收集示意图
                
    ┌─────┐      ┌─────┐      ┌─────┐      ┌─────┐
    │Source│────▶│Relay1│────▶│Relay2│────▶│Target│
    └─────┘      └──┬──┘      └──┬──┘      └──┬──┘
      (绿色)         │(橙色)       │(橙色)      │(绿色)
                     │            │            │
                     │            │            │
                  ┌──▼──┐      ┌──▼──┐      ┌──▼──┐
                  │Node1│      │Node2│      │Node3│
                  └─────┘      └─────┘      └─────┘
                  (浅蓝)        (浅蓝)       (浅蓝)
                  
    信息标注示例：
    Relay1: B_v1=50, A_v1=10
    Node1:  B_n1=20, A_n1=25
    
    图例：
    ──── 能量传输路径（红色实线）
    ┄┄┄ 信息收集路径（蓝色虚线）
```

## 通用制作技巧

### 1. 数学公式输入
- Draw.io支持部分LaTeX语法
- 可以使用"插入" → "数学类型"来输入公式
- 或者直接使用文本，用$符号包围：$E_i(t)$

### 2. 对齐和分布
- 选中多个形状 → 排列 → 对齐（左对齐、居中对齐等）
- 排列 → 分布（水平分布、垂直分布）

### 3. 样式统一
- 创建样式模板，应用到所有相同类型的形状
- 使用"格式刷"工具快速复制样式

### 4. 导出设置
- **PNG格式**：用于LaTeX编译
- **分辨率**：至少300 DPI
- **背景**：白色或透明
- **边框**：包含边框（确保图片完整）

### 5. 保存源文件
- 保存Draw.io源文件（.drawio格式），方便后续修改
- 建议保存在同一目录下

## 检查清单

制作完成后，请检查：
- [ ] 所有文字清晰可读
- [ ] 箭头方向正确
- [ ] 颜色对比度足够（考虑黑白打印）
- [ ] 图片尺寸适合LaTeX（宽度约0.9\linewidth）
- [ ] 文件名与LaTeX代码中的一致
- [ ] 图片已保存到正确目录

## 文件结构

完成后，`paper_p/sections/figures/` 目录应包含：

```
figures/
├── aoei_adaptive_threshold.png          (Python生成)
├── aoei_adaptive_threshold.pdf          (Python生成)
├── infonode_energy_estimation.png       (Draw.io导出)
├── infonode_energy_estimation.drawio    (Draw.io源文件)
├── aldp_score_function.png              (Python生成)
├── aldp_score_function.pdf              (Python生成)
├── eetor_path_selection.png             (Draw.io导出)
├── eetor_path_selection.drawio          (Draw.io源文件)
├── generate_function_plots.py           (Python脚本)
├── drawio_flowcharts.md                 (本文件)
└── README_如何添加图片.md               (总说明)
```

